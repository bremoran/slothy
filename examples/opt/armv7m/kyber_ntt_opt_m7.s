/******************************************************************************
* Integrating the improved Plantard arithmetic into Kyber.
*
* Efficient Plantard arithmetic enables a faster Kyber implementation with the
* same stack usage.
*
* See the paper at https:// eprint.iacr.org/2022/956.pdf for more details.
*
* @author   Junhao Huang, BNU-HKBU United International College, Zhuhai, China
*           jhhuang_nuaa@126.com
*
* @date     September 2022
******************************************************************************/
#include "macros.i"

.syntax unified
.cpu cortex-m4
.thumb

.macro load a, a0, a1, a2, a3, mem0, mem1, mem2, mem3
  ldr.w \a0, [\a, \mem0]
  ldr.w \a1, [\a, \mem1]
  ldr.w \a2, [\a, \mem2]
  ldr.w \a3, [\a, \mem3]
.endm

.macro store a, a0, a1, a2, a3, mem0, mem1, mem2, mem3
  str.w \a0, [\a, \mem0]
  str.w \a1, [\a, \mem1]
  str.w \a2, [\a, \mem2]
  str.w \a3, [\a, \mem3]
.endm

.macro doubleplant a, tmp, q, qa, plantconst
 smulwb \tmp, \plantconst, \a
 smulwt \a, \plantconst, \a
 smlabt \tmp, \tmp, \q, \qa
 smlabt \a, \a, \q, \qa
 pkhtb \a, \a, \tmp, asr#16
.endm

.macro doublebarrett a, tmp, tmp2, q, barrettconst
  smulbb \tmp, \a, \barrettconst
  smultb \tmp2, \a, \barrettconst
  asr \tmp, \tmp, #26
  asr \tmp2, \tmp2, #26
  smulbb \tmp, \tmp, \q
  smulbb \tmp2, \tmp2, \q
  pkhbt \tmp, \tmp, \tmp2, lsl#16
  usub16 \a, \a, \tmp
.endm

// q locate in the top half of the register
.macro plant_red q, qa, qinv, tmp
 mul \tmp, \tmp, \qinv
 // tmp*qinv mod 2^2n/ 2^n; in high half
 smlatt \tmp, \tmp, \q, \qa
 // result in high half
.endm

.macro mul_twiddle_plant a, twiddle, tmp, q, qa
 smulwb \tmp, \twiddle, \a
 smulwt \a,   \twiddle, \a
 smlabt \tmp, \tmp, \q, \qa
 smlabt \a, \a, \q, \qa
 pkhtb \a, \a, \tmp, asr#16
.endm

.macro doublebutterfly_plant a0, a1, twiddle, tmp, q, qa
 smulwb \tmp, \twiddle, \a1
 smulwt \a1, \twiddle, \a1
 smlabt \tmp, \tmp, \q, \qa
 smlabt \a1, \a1, \q, \qa
 pkhtb \tmp, \a1, \tmp, asr#16
 usub16 \a1, \a0, \tmp
 uadd16 \a0, \a0, \tmp
.endm

.macro two_doublebutterfly_plant a0, a1, a2, a3, twiddle0, twiddle1, tmp, q, qa
 doublebutterfly_plant \a0, \a1, \twiddle0, \tmp, \q, \qa
 doublebutterfly_plant \a2, \a3, \twiddle1, \tmp, \q, \qa
.endm

.macro _3_layer_double_CT_16_plant c0, c1, c2, c3, c4, c5, c6, c7, twiddle1, twiddle2, twiddle_ptr, q, qa, tmp
 // layer 3
 ldr.w \twiddle1, [\twiddle_ptr], #4
 two_doublebutterfly_plant \c0, \c4, \c1, \c5, \twiddle1, \twiddle1, \tmp, \q, \qa
 two_doublebutterfly_plant \c2, \c6, \c3, \c7, \twiddle1, \twiddle1, \tmp, \q, \qa

 // layer 2
 ldrd \twiddle1, \twiddle2, [\twiddle_ptr], #8
 two_doublebutterfly_plant \c0, \c2, \c1, \c3, \twiddle1, \twiddle1, \tmp, \q, \qa

 two_doublebutterfly_plant \c4, \c6, \c5, \c7, \twiddle2, \twiddle2, \tmp, \q, \qa

 // layer 1
 ldrd \twiddle1, \twiddle2, [\twiddle_ptr], #8
 two_doublebutterfly_plant \c0, \c1, \c2, \c3, \twiddle1, \twiddle2, \tmp, \q, \qa

 ldrd \twiddle1, \twiddle2, [\twiddle_ptr], #8
 two_doublebutterfly_plant \c4, \c5, \c6, \c7, \twiddle1, \twiddle2, \tmp, \q, \qa
.endm

.macro _3_layer_double_CT_16_plant_fp c0, c1, c2, c3, c4, c5, c6, c7, xi0, xi1, xi2, xi3, xi4, xi5, xi6, twiddle1, twiddle2, q, qa, tmp
 // layer 3
 vmov \twiddle1, \xi0
 two_doublebutterfly_plant \c0, \c4, \c1, \c5, \twiddle1, \twiddle1, \tmp, \q, \qa
 two_doublebutterfly_plant \c2, \c6, \c3, \c7, \twiddle1, \twiddle1, \tmp, \q, \qa

 // layer 2
 vmov \twiddle1, \xi1
 vmov \twiddle2, \xi2
 two_doublebutterfly_plant \c0, \c2, \c1, \c3, \twiddle1, \twiddle1, \tmp, \q, \qa

 two_doublebutterfly_plant \c4, \c6, \c5, \c7, \twiddle2, \twiddle2, \tmp, \q, \qa

 // layer 1
 vmov \twiddle1, \xi3
 vmov \twiddle2, \xi4
 two_doublebutterfly_plant \c0, \c1, \c2, \c3, \twiddle1, \twiddle2, \tmp, \q, \qa

 vmov \twiddle1, \xi5
 vmov \twiddle2, \xi6
 two_doublebutterfly_plant \c4, \c5, \c6, \c7, \twiddle1, \twiddle2, \tmp, \q, \qa
.endm

.global ntt_fast_opt_m7
.type ntt_fast_opt_m7, %function
.align 2
ntt_fast_opt_m7:
 push {r4-r11, r14}
 vpush.w {s16-s24}
 poly         .req r0
 twiddle_ptr  .req r1
 poly0        .req r2
 poly1        .req r3
 poly2        .req r4
 poly3        .req r5
 poly4        .req r6
 poly5        .req r7
 poly6        .req r8
 poly7        .req r9
 twiddle1     .req r10
 twiddle2     .req r11
 ###  qinv        .req r11 ### q^-1 mod 2^2n; n=16
 q           .req r12
 ### at the top of r12
 qa          .req r0
 ### qa=2^a q;a=3; at the bottom of r12
 tmp         .req r14

 // movw qa, #26632
 // Why movt? Because we initially placed qa at the bottom of the same register as q;
 movt q, #3329

 ### LAYER 7+6+5+4
 .equ distance, 256
 .equ offset, 32
 .equ strincr, 4
 // pre-load 15 twiddle factors to 15 FPU registers
 // s0-s7 used to temporary store 16 16-bit polys.
 vldm twiddle_ptr!, {s8-s22}

 add tmp, poly, #strincr*8
 // s23: poly addr
 // s24: tmp
 vmov s24, tmp
 1:
        layer1234_start:
                                                     // Instructions:    300
                                                     // Expected cycles: 150
                                                     // Expected IPC:    2.00
                                                     //
                                                     // Wall time:     35.21s
                                                     // User time:     35.21s
                                                     //
                                                     // ----------------------------------------------------------------- cycle (expected) ------------------------------------------------------------------>
                                                     // 0                        25                       50                       75                       100                      125
                                                     // |------------------------|------------------------|------------------------|------------------------|------------------------|
        ldr.w r14, [r0, #offset]                     // *.....................................................................................................................................................
        vmov s26, r0                                 // *.....................................................................................................................................................
        ldr.w r3, [r0, #distance/4+offset]           // .*....................................................................................................................................................
        ldr.w r4, [r0, #2*distance/4+offset]         // .*....................................................................................................................................................
        ldr.w r2, [r0, #3*distance/4+offset]         // ..*...................................................................................................................................................
        ldr.w r6, [r0, #distance+offset]             // ..*...................................................................................................................................................
        ldr.w r11, [r0, #5*distance/4+offset]        // ...*..................................................................................................................................................
        ldr.w r8, [r0, #6*distance/4+offset]         // ...*..................................................................................................................................................
        ldr.w r5, [r0, #7*distance/4+offset]         // ....*.................................................................................................................................................
        movw r9, #26632                              // ....*.................................................................................................................................................
        vmov r1, s8                                  // .....*................................................................................................................................................
        smulwb r10, r1, r6                           // .....*................................................................................................................................................
        smulwt r6, r1, r6                            // ......*...............................................................................................................................................
        smlabt r7, r10, r12, r9                      // ......*...............................................................................................................................................
        smlabt r10, r6, r12, r9                      // .......*..............................................................................................................................................
        pkhtb r6, r10, r7, asr#16                    // .......*..............................................................................................................................................
        usub16 r7, r14, r6                           // ........*.............................................................................................................................................
        uadd16 r10, r14, r6                          // ........*.............................................................................................................................................
        smulwt r0, r1, r11                           // .........*............................................................................................................................................
        smulwb r11, r1, r11                          // .........*............................................................................................................................................
        smlabt r6, r11, r12, r9                      // ..........*...........................................................................................................................................
        smlabt r11, r0, r12, r9                      // ..........*...........................................................................................................................................
        pkhtb r14, r11, r6, asr#16                   // ...........*..........................................................................................................................................
        usub16 r6, r3, r14                           // ...........*..........................................................................................................................................
        uadd16 r14, r3, r14                          // ............*.........................................................................................................................................
        smulwb r11, r1, r8                           // ............*.........................................................................................................................................
        smulwt r3, r1, r8                            // .............*........................................................................................................................................
        smlabt r11, r11, r12, r9                     // .............*........................................................................................................................................
        smlabt r3, r3, r12, r9                       // ..............*.......................................................................................................................................
        pkhtb r3, r3, r11, asr#16                    // ..............*.......................................................................................................................................
        usub16 r0, r4, r3                            // ...............*......................................................................................................................................
        uadd16 r8, r4, r3                            // ...............*......................................................................................................................................
        smulwb r4, r1, r5                            // ................*.....................................................................................................................................
        smulwt r3, r1, r5                            // ................*.....................................................................................................................................
        smlabt r4, r4, r12, r9                       // .................*....................................................................................................................................
        smlabt r3, r3, r12, r9                       // .................*....................................................................................................................................
        pkhtb r3, r3, r4, asr#16                     // ..................*...................................................................................................................................
        usub16 r11, r2, r3                           // ..................*...................................................................................................................................
        uadd16 r1, r2, r3                            // ...................*..................................................................................................................................
        vmov r5, s9                                  // ...................*..................................................................................................................................
        vmov r2, s10                                 // ....................*.................................................................................................................................
        smulwb r4, r5, r8                            // ....................*.................................................................................................................................
        smulwt r3, r5, r8                            // .....................*................................................................................................................................
        smlabt r4, r4, r12, r9                       // .....................*................................................................................................................................
        smlabt r3, r3, r12, r9                       // ......................*...............................................................................................................................
        pkhtb r3, r3, r4, asr#16                     // ......................*...............................................................................................................................
        usub16 r8, r10, r3                           // .......................*..............................................................................................................................
        uadd16 r10, r10, r3                          // .......................*..............................................................................................................................
        smulwb r4, r5, r1                            // ........................*.............................................................................................................................
        smulwt r3, r5, r1                            // ........................*.............................................................................................................................
        smlabt r4, r4, r12, r9                       // .........................*............................................................................................................................
        smlabt r3, r3, r12, r9                       // .........................*............................................................................................................................
        pkhtb r3, r3, r4, asr#16                     // ..........................*...........................................................................................................................
        usub16 r5, r14, r3                           // ..........................*...........................................................................................................................
        uadd16 r1, r14, r3                           // ...........................*..........................................................................................................................
        smulwb r4, r2, r0                            // ...........................*..........................................................................................................................
        smulwt r3, r2, r0                            // ............................*.........................................................................................................................
        smlabt r0, r4, r12, r9                       // ............................*.........................................................................................................................
        smlabt r3, r3, r12, r9                       // .............................*........................................................................................................................
        pkhtb r3, r3, r0, asr#16                     // .............................*........................................................................................................................
        usub16 r0, r7, r3                            // ..............................*.......................................................................................................................
        uadd16 r14, r7, r3                           // ..............................*.......................................................................................................................
        smulwb r4, r2, r11                           // ...............................*......................................................................................................................
        smulwt r3, r2, r11                           // ...............................*......................................................................................................................
        smlabt r4, r4, r12, r9                       // ................................*.....................................................................................................................
        smlabt r3, r3, r12, r9                       // ................................*.....................................................................................................................
        pkhtb r3, r3, r4, asr#16                     // .................................*....................................................................................................................
        usub16 r7, r6, r3                            // .................................*....................................................................................................................
        uadd16 r11, r6, r3                           // ..................................*...................................................................................................................
        vmov r3, s11                                 // ..................................*...................................................................................................................
        vmov r6, s12                                 // ...................................*..................................................................................................................
        smulwb r2, r3, r1                            // ...................................*..................................................................................................................
        smulwt r3, r3, r1                            // ....................................*.................................................................................................................
        smlabt r4, r2, r12, r9                       // ....................................*.................................................................................................................
        smlabt r3, r3, r12, r9                       // .....................................*................................................................................................................
        pkhtb r3, r3, r4, asr#16                     // .....................................*................................................................................................................
        usub16 r1, r10, r3                           // ......................................*...............................................................................................................
        uadd16 r10, r10, r3                          // ......................................*...............................................................................................................
        smulwb r4, r6, r5                            // .......................................*..............................................................................................................
        smulwt r3, r6, r5                            // .......................................*..............................................................................................................
        smlabt r4, r4, r12, r9                       // ........................................*.............................................................................................................
        smlabt r3, r3, r12, r9                       // ........................................*.............................................................................................................
        pkhtb r3, r3, r4, asr#16                     // .........................................*............................................................................................................
        usub16 r5, r8, r3                            // .........................................*............................................................................................................
        uadd16 r8, r8, r3                            // ..........................................*...........................................................................................................
        vmov r3, s13                                 // ..........................................*...........................................................................................................
        vmov r2, s14                                 // ...........................................*..........................................................................................................
        smulwb r4, r3, r11                           // ...........................................*..........................................................................................................
        smulwt r3, r3, r11                           // ............................................*.........................................................................................................
        smlabt r4, r4, r12, r9                       // ............................................*.........................................................................................................
        smlabt r3, r3, r12, r9                       // .............................................*........................................................................................................
        pkhtb r3, r3, r4, asr#16                     // .............................................*........................................................................................................
        usub16 r11, r14, r3                          // ..............................................*.......................................................................................................
        uadd16 r6, r14, r3                           // ..............................................*.......................................................................................................
        smulwb r4, r2, r7                            // ...............................................*......................................................................................................
        smulwt r3, r2, r7                            // ...............................................*......................................................................................................
        smlabt r4, r4, r12, r9                       // ................................................*.....................................................................................................
        smlabt r3, r3, r12, r9                       // ................................................*.....................................................................................................
        pkhtb r3, r3, r4, asr#16                     // .................................................*....................................................................................................
        usub16 r14, r0, r3                           // .................................................*....................................................................................................
        uadd16 r0, r0, r3                            // ..................................................*...................................................................................................
        vmov r3, s15                                 // ..................................................*...................................................................................................
        vmov r2, s16                                 // ...................................................*..................................................................................................
        smulwb r4, r3, r10                           // ...................................................*..................................................................................................
        smulwt r3, r3, r10                           // ....................................................*.................................................................................................
        smlabt r4, r4, r12, r9                       // ....................................................*.................................................................................................
        smlabt r3, r3, r12, r9                       // .....................................................*................................................................................................
        pkhtb r7, r3, r4, asr#16                     // .....................................................*................................................................................................
        smulwb r3, r2, r1                            // ......................................................*...............................................................................................
        smulwt r2, r2, r1                            // ......................................................*...............................................................................................
        smlabt r4, r3, r12, r9                       // .......................................................*..............................................................................................
        smlabt r3, r2, r12, r9                       // .......................................................*..............................................................................................
        pkhtb r1, r3, r4, asr#16                     // ........................................................*.............................................................................................
        vmov r3, s17                                 // ........................................................*.............................................................................................
        vmov r2, s18                                 // .........................................................*............................................................................................
        smulwb r4, r3, r8                            // .........................................................*............................................................................................
        smulwt r3, r3, r8                            // ..........................................................*...........................................................................................
        smlabt r4, r4, r12, r9                       // ..........................................................*...........................................................................................
        smlabt r3, r3, r12, r9                       // ...........................................................*..........................................................................................
        pkhtb r10, r3, r4, asr#16                    // ...........................................................*..........................................................................................
        smulwb r4, r2, r5                            // ............................................................*.........................................................................................
        smulwt r3, r2, r5                            // ............................................................*.........................................................................................
        smlabt r4, r4, r12, r9                       // .............................................................*........................................................................................
        smlabt r3, r3, r12, r9                       // .............................................................*........................................................................................
        pkhtb r5, r3, r4, asr#16                     // ..............................................................*.......................................................................................
        vmov r3, s19                                 // ..............................................................*.......................................................................................
        vmov r2, s20                                 // ...............................................................*......................................................................................
        smulwb r4, r3, r6                            // ...............................................................*......................................................................................
        smulwt r3, r3, r6                            // ................................................................*.....................................................................................
        smlabt r4, r4, r12, r9                       // ................................................................*.....................................................................................
        smlabt r3, r3, r12, r9                       // .................................................................*....................................................................................
        pkhtb r8, r3, r4, asr#16                     // .................................................................*....................................................................................
        smulwb r4, r2, r11                           // ..................................................................*...................................................................................
        smulwt r3, r2, r11                           // ..................................................................*...................................................................................
        smlabt r4, r4, r12, r9                       // ...................................................................*..................................................................................
        smlabt r3, r3, r12, r9                       // ...................................................................*..................................................................................
        pkhtb r11, r3, r4, asr#16                    // ....................................................................*.................................................................................
        vmov r3, s21                                 // ....................................................................*.................................................................................
        vmov r6, s22                                 // .....................................................................*................................................................................
        smulwb r4, r3, r0                            // .....................................................................*................................................................................
        smulwt r3, r3, r0                            // ......................................................................*...............................................................................
        smlabt r4, r4, r12, r9                       // ......................................................................*...............................................................................
        smlabt r3, r3, r12, r9                       // .......................................................................*..............................................................................
        pkhtb r2, r3, r4, asr#16                     // .......................................................................*..............................................................................
        smulwb r4, r6, r14                           // ........................................................................*.............................................................................
        smulwt r3, r6, r14                           // ........................................................................*.............................................................................
        smlabt r4, r4, r12, r9                       // .........................................................................*............................................................................
        smlabt r3, r3, r12, r9                       // .........................................................................*............................................................................
        pkhtb r3, r3, r4, asr#16                     // ..........................................................................*...........................................................................
        vmov s7, r7                                  // ..........................................................................*...........................................................................
        vmov s2, r1                                  // ...........................................................................*..........................................................................
        vmov s5, r10                                 // ...........................................................................*..........................................................................
        vmov s30, r5                                 // ............................................................................*.........................................................................
        vmov s0, r8                                  // ............................................................................*.........................................................................
        vmov s28, r11                                // .............................................................................*........................................................................
        vmov s6, r2                                  // .............................................................................*........................................................................
        vmov s1, r3                                  // ..............................................................................*.......................................................................
        vmov r4, s26                                 // ..............................................................................*.......................................................................
        ldr.w r1, [r4, #0]                           // ...............................................................................*......................................................................
        ldr.w r14, [r4, #distance/4]                 // ...............................................................................*......................................................................
        ldr.w r0, [r4, #2*distance/4]                // ................................................................................*.....................................................................
        ldr.w r10, [r4, #3*distance/4]               // ................................................................................*.....................................................................
        ldr.w r3, [r4, #distance]                    // .................................................................................*....................................................................
        ldr.w r8, [r4, #5*distance/4]                // .................................................................................*....................................................................
        ldr.w r5, [r4, #6*distance/4]                // ..................................................................................*...................................................................
        ldr.w r6, [r4, #7*distance/4]                // ..................................................................................*...................................................................
        movw r9, #26632                              // ...................................................................................*..................................................................
        vmov r2, s8                                  // ...................................................................................*..................................................................
        smulwb r4, r2, r3                            // ....................................................................................*.................................................................
        smulwt r3, r2, r3                            // ....................................................................................*.................................................................
        smlabt r4, r4, r12, r9                       // .....................................................................................*................................................................
        smlabt r3, r3, r12, r9                       // .....................................................................................*................................................................
        pkhtb r3, r3, r4, asr#16                     // ......................................................................................*...............................................................
        usub16 r11, r1, r3                           // ......................................................................................*...............................................................
        uadd16 r1, r1, r3                            // .......................................................................................*..............................................................
        smulwb r4, r2, r8                            // .......................................................................................*..............................................................
        smulwt r3, r2, r8                            // ........................................................................................*.............................................................
        smlabt r4, r4, r12, r9                       // ........................................................................................*.............................................................
        smlabt r3, r3, r12, r9                       // .........................................................................................*............................................................
        pkhtb r3, r3, r4, asr#16                     // .........................................................................................*............................................................
        usub16 r7, r14, r3                           // ..........................................................................................*...........................................................
        uadd16 r8, r14, r3                           // ..........................................................................................*...........................................................
        smulwb r4, r2, r5                            // ...........................................................................................*..........................................................
        smulwt r3, r2, r5                            // ...........................................................................................*..........................................................
        smlabt r4, r4, r12, r9                       // ............................................................................................*.........................................................
        smlabt r3, r3, r12, r9                       // ............................................................................................*.........................................................
        pkhtb r3, r3, r4, asr#16                     // .............................................................................................*........................................................
        usub16 r14, r0, r3                           // .............................................................................................*........................................................
        uadd16 r5, r0, r3                            // ..............................................................................................*.......................................................
        smulwb r4, r2, r6                            // ..............................................................................................*.......................................................
        smulwt r3, r2, r6                            // ...............................................................................................*......................................................
        smlabt r4, r4, r12, r9                       // ...............................................................................................*......................................................
        smlabt r3, r3, r12, r9                       // ................................................................................................*.....................................................
        pkhtb r3, r3, r4, asr#16                     // ................................................................................................*.....................................................
        usub16 r0, r10, r3                           // .................................................................................................*....................................................
        uadd16 r10, r10, r3                          // .................................................................................................*....................................................
        vmov r6, s9                                  // ..................................................................................................*...................................................
        vmov r2, s10                                 // ..................................................................................................*...................................................
        smulwb r4, r6, r5                            // ...................................................................................................*..................................................
        smulwt r3, r6, r5                            // ...................................................................................................*..................................................
        smlabt r4, r4, r12, r9                       // ....................................................................................................*.................................................
        smlabt r3, r3, r12, r9                       // ....................................................................................................*.................................................
        pkhtb r3, r3, r4, asr#16                     // .....................................................................................................*................................................
        usub16 r5, r1, r3                            // .....................................................................................................*................................................
        uadd16 r1, r1, r3                            // ......................................................................................................*...............................................
        smulwb r4, r6, r10                           // ......................................................................................................*...............................................
        smulwt r3, r6, r10                           // .......................................................................................................*..............................................
        smlabt r4, r4, r12, r9                       // .......................................................................................................*..............................................
        smlabt r3, r3, r12, r9                       // ........................................................................................................*.............................................
        pkhtb r3, r3, r4, asr#16                     // ........................................................................................................*.............................................
        usub16 r10, r8, r3                           // .........................................................................................................*............................................
        uadd16 r8, r8, r3                            // .........................................................................................................*............................................
        smulwb r4, r2, r14                           // ..........................................................................................................*...........................................
        smulwt r3, r2, r14                           // ..........................................................................................................*...........................................
        smlabt r4, r4, r12, r9                       // ...........................................................................................................*..........................................
        smlabt r3, r3, r12, r9                       // ...........................................................................................................*..........................................
        pkhtb r3, r3, r4, asr#16                     // ............................................................................................................*.........................................
        usub16 r14, r11, r3                          // ............................................................................................................*.........................................
        uadd16 r11, r11, r3                          // .............................................................................................................*........................................
        smulwb r4, r2, r0                            // .............................................................................................................*........................................
        smulwt r3, r2, r0                            // ..............................................................................................................*.......................................
        smlabt r4, r4, r12, r9                       // ..............................................................................................................*.......................................
        smlabt r3, r3, r12, r9                       // ...............................................................................................................*......................................
        pkhtb r3, r3, r4, asr#16                     // ...............................................................................................................*......................................
        usub16 r0, r7, r3                            // ................................................................................................................*.....................................
        uadd16 r6, r7, r3                            // ................................................................................................................*.....................................
        vmov r3, s11                                 // .................................................................................................................*....................................
        vmov r2, s12                                 // .................................................................................................................*....................................
        smulwb r4, r3, r8                            // ..................................................................................................................*...................................
        smulwt r3, r3, r8                            // ..................................................................................................................*...................................
        smlabt r4, r4, r12, r9                       // ...................................................................................................................*..................................
        smlabt r3, r3, r12, r9                       // ...................................................................................................................*..................................
        pkhtb r3, r3, r4, asr#16                     // ....................................................................................................................*.................................
        usub16 r7, r1, r3                            // ....................................................................................................................*.................................
        uadd16 r1, r1, r3                            // .....................................................................................................................*................................
        smulwb r4, r2, r10                           // .....................................................................................................................*................................
        smulwt r3, r2, r10                           // ......................................................................................................................*...............................
        smlabt r4, r4, r12, r9                       // ......................................................................................................................*...............................
        smlabt r3, r3, r12, r9                       // .......................................................................................................................*..............................
        pkhtb r3, r3, r4, asr#16                     // .......................................................................................................................*..............................
        usub16 r10, r5, r3                           // ........................................................................................................................*.............................
        uadd16 r5, r5, r3                            // ........................................................................................................................*.............................
        vmov r3, s13                                 // .........................................................................................................................*............................
        vmov r2, s14                                 // .........................................................................................................................*............................
        smulwb r4, r3, r6                            // ..........................................................................................................................*...........................
        smulwt r3, r3, r6                            // ..........................................................................................................................*...........................
        smlabt r4, r4, r12, r9                       // ...........................................................................................................................*..........................
        smlabt r3, r3, r12, r9                       // ...........................................................................................................................*..........................
        pkhtb r3, r3, r4, asr#16                     // ............................................................................................................................*.........................
        usub16 r8, r11, r3                           // ............................................................................................................................*.........................
        uadd16 r11, r11, r3                          // .............................................................................................................................*........................
        smulwb r4, r2, r0                            // .............................................................................................................................*........................
        smulwt r3, r2, r0                            // ..............................................................................................................................*.......................
        smlabt r4, r4, r12, r9                       // ..............................................................................................................................*.......................
        smlabt r3, r3, r12, r9                       // ...............................................................................................................................*......................
        pkhtb r3, r3, r4, asr#16                     // ...............................................................................................................................*......................
        usub16 r6, r14, r3                           // ................................................................................................................................*.....................
        uadd16 r2, r14, r3                           // ................................................................................................................................*.....................
        vmov r0, s26                                 // .................................................................................................................................*....................
        vmov r3, s2                                  // .................................................................................................................................*....................
        uadd16 r4, r7, r3                            // ..................................................................................................................................*...................
        usub16 r3, r7, r3                            // ..................................................................................................................................*...................
        str.w r4, [r0, #1*distance/4]                // ...................................................................................................................................*..................
        str.w r3, [r0, #1*distance/4+offset]         // ...................................................................................................................................*..................
        vmov r3, s30                                 // ....................................................................................................................................*.................
        uadd16 r4, r10, r3                           // ....................................................................................................................................*.................
        usub16 r3, r10, r3                           // .....................................................................................................................................*................
        str.w r4, [r0, #3*distance/4]                // .....................................................................................................................................*................
        str.w r3, [r0, #3*distance/4+offset]         // ......................................................................................................................................*...............
        vmov r3, s28                                 // ......................................................................................................................................*...............
        uadd16 r4, r8, r3                            // .......................................................................................................................................*..............
        usub16 r3, r8, r3                            // .......................................................................................................................................*..............
        str.w r4, [r0, #5*distance/4]                // ........................................................................................................................................*.............
        str.w r3, [r0, #5*distance/4+offset]         // ........................................................................................................................................*.............
        vmov r3, s1                                  // .........................................................................................................................................*............
        uadd16 r4, r6, r3                            // .........................................................................................................................................*............
        usub16 r3, r6, r3                            // ..........................................................................................................................................*...........
        str.w r4, [r0, #7*distance/4]                // ..........................................................................................................................................*...........
        str.w r3, [r0, #7*distance/4+offset]         // ...........................................................................................................................................*..........
        vmov r3, s5                                  // ...........................................................................................................................................*..........
        uadd16 r4, r5, r3                            // ............................................................................................................................................*.........
        usub16 r3, r5, r3                            // ............................................................................................................................................*.........
        str.w r4, [r0, #2*distance/4]                // .............................................................................................................................................*........
        str.w r3, [r0, #2*distance/4+offset]         // .............................................................................................................................................*........
        vmov r3, s0                                  // ..............................................................................................................................................*.......
        uadd16 r4, r11, r3                           // ..............................................................................................................................................*.......
        usub16 r3, r11, r3                           // ...............................................................................................................................................*......
        str.w r4, [r0, #4*distance/4]                // ...............................................................................................................................................*......
        str.w r3, [r0, #4*distance/4+offset]         // ................................................................................................................................................*.....
        vmov r3, s6                                  // ................................................................................................................................................*.....
        uadd16 r4, r2, r3                            // .................................................................................................................................................*....
        usub16 r3, r2, r3                            // .................................................................................................................................................*....
        str.w r4, [r0, #6*distance/4]                // ..................................................................................................................................................*...
        str.w r3, [r0, #6*distance/4+offset]         // ..................................................................................................................................................*...
        vmov r3, s7                                  // ...................................................................................................................................................*..
        uadd16 r4, r1, r3                            // ...................................................................................................................................................*..
        usub16 r3, r1, r3                            // ....................................................................................................................................................*.
        str.w r3, [r0, #offset]                      // ....................................................................................................................................................*.
        vmov r14, s24                                // .....................................................................................................................................................*
        str.w r4, [r0], #4                           // .....................................................................................................................................................*

                                                      // ----------------------------------------------------------------- cycle (expected) ------------------------------------------------------------------>
                                                      // 0                        25                       50                       75                       100                      125
                                                      // |------------------------|------------------------|------------------------|------------------------|------------------------|------------------------
        // vmov s23, r0                               // *.....................................................................................................................................................
        // ldr.w r2, [r0, #offset]                    // *.....................................................................................................................................................
        // ldr.w r3, [r0, #distance/4+offset]         // .*....................................................................................................................................................
        // ldr.w r4, [r0, #2*distance/4+offset]       // .*....................................................................................................................................................
        // ldr.w r5, [r0, #3*distance/4+offset]       // ..*...................................................................................................................................................
        // ldr.w r6, [r0, #distance+offset]           // ..*...................................................................................................................................................
        // ldr.w r7, [r0, #5*distance/4+offset]       // ...*..................................................................................................................................................
        // ldr.w r8, [r0, #6*distance/4+offset]       // ...*..................................................................................................................................................
        // ldr.w r9, [r0, #7*distance/4+offset]       // ....*.................................................................................................................................................
        // movw r0, #26632                            // ....*.................................................................................................................................................
        // vmov r10, s8                               // .....*................................................................................................................................................
        // smulwb r14, r10, r6                        // .....*................................................................................................................................................
        // smulwt r6, r10, r6                         // ......*...............................................................................................................................................
        // smlabt r14, r14, r12, r0                   // ......*...............................................................................................................................................
        // smlabt r6, r6, r12, r0                     // .......*..............................................................................................................................................
        // pkhtb r14, r6, r14, asr#16                 // .......*..............................................................................................................................................
        // usub16 r6, r2, r14                         // ........*.............................................................................................................................................
        // uadd16 r2, r2, r14                         // ........*.............................................................................................................................................
        // smulwb r14, r10, r7                        // .........*............................................................................................................................................
        // smulwt r7, r10, r7                         // .........*............................................................................................................................................
        // smlabt r14, r14, r12, r0                   // ..........*...........................................................................................................................................
        // smlabt r7, r7, r12, r0                     // ..........*...........................................................................................................................................
        // pkhtb r14, r7, r14, asr#16                 // ...........*..........................................................................................................................................
        // usub16 r7, r3, r14                         // ...........*..........................................................................................................................................
        // uadd16 r3, r3, r14                         // ............*.........................................................................................................................................
        // smulwb r14, r10, r8                        // ............*.........................................................................................................................................
        // smulwt r8, r10, r8                         // .............*........................................................................................................................................
        // smlabt r14, r14, r12, r0                   // .............*........................................................................................................................................
        // smlabt r8, r8, r12, r0                     // ..............*.......................................................................................................................................
        // pkhtb r14, r8, r14, asr#16                 // ..............*.......................................................................................................................................
        // usub16 r8, r4, r14                         // ...............*......................................................................................................................................
        // uadd16 r4, r4, r14                         // ...............*......................................................................................................................................
        // smulwb r14, r10, r9                        // ................*.....................................................................................................................................
        // smulwt r9, r10, r9                         // ................*.....................................................................................................................................
        // smlabt r14, r14, r12, r0                   // .................*....................................................................................................................................
        // smlabt r9, r9, r12, r0                     // .................*....................................................................................................................................
        // pkhtb r14, r9, r14, asr#16                 // ..................*...................................................................................................................................
        // usub16 r9, r5, r14                         // ..................*...................................................................................................................................
        // uadd16 r5, r5, r14                         // ...................*..................................................................................................................................
        // vmov r10, s9                               // ...................*..................................................................................................................................
        // vmov r11, s10                              // ....................*.................................................................................................................................
        // smulwb r14, r10, r4                        // ....................*.................................................................................................................................
        // smulwt r4, r10, r4                         // .....................*................................................................................................................................
        // smlabt r14, r14, r12, r0                   // .....................*................................................................................................................................
        // smlabt r4, r4, r12, r0                     // ......................*...............................................................................................................................
        // pkhtb r14, r4, r14, asr#16                 // ......................*...............................................................................................................................
        // usub16 r4, r2, r14                         // .......................*..............................................................................................................................
        // uadd16 r2, r2, r14                         // .......................*..............................................................................................................................
        // smulwb r14, r10, r5                        // ........................*.............................................................................................................................
        // smulwt r5, r10, r5                         // ........................*.............................................................................................................................
        // smlabt r14, r14, r12, r0                   // .........................*............................................................................................................................
        // smlabt r5, r5, r12, r0                     // .........................*............................................................................................................................
        // pkhtb r14, r5, r14, asr#16                 // ..........................*...........................................................................................................................
        // usub16 r5, r3, r14                         // ..........................*...........................................................................................................................
        // uadd16 r3, r3, r14                         // ...........................*..........................................................................................................................
        // smulwb r14, r11, r8                        // ...........................*..........................................................................................................................
        // smulwt r8, r11, r8                         // ............................*.........................................................................................................................
        // smlabt r14, r14, r12, r0                   // ............................*.........................................................................................................................
        // smlabt r8, r8, r12, r0                     // .............................*........................................................................................................................
        // pkhtb r14, r8, r14, asr#16                 // .............................*........................................................................................................................
        // usub16 r8, r6, r14                         // ..............................*.......................................................................................................................
        // uadd16 r6, r6, r14                         // ..............................*.......................................................................................................................
        // smulwb r14, r11, r9                        // ...............................*......................................................................................................................
        // smulwt r9, r11, r9                         // ...............................*......................................................................................................................
        // smlabt r14, r14, r12, r0                   // ................................*.....................................................................................................................
        // smlabt r9, r9, r12, r0                     // ................................*.....................................................................................................................
        // pkhtb r14, r9, r14, asr#16                 // .................................*....................................................................................................................
        // usub16 r9, r7, r14                         // .................................*....................................................................................................................
        // uadd16 r7, r7, r14                         // ..................................*...................................................................................................................
        // vmov r10, s11                              // ..................................*...................................................................................................................
        // vmov r11, s12                              // ...................................*..................................................................................................................
        // smulwb r14, r10, r3                        // ...................................*..................................................................................................................
        // smulwt r3, r10, r3                         // ....................................*.................................................................................................................
        // smlabt r14, r14, r12, r0                   // ....................................*.................................................................................................................
        // smlabt r3, r3, r12, r0                     // .....................................*................................................................................................................
        // pkhtb r14, r3, r14, asr#16                 // .....................................*................................................................................................................
        // usub16 r3, r2, r14                         // ......................................*...............................................................................................................
        // uadd16 r2, r2, r14                         // ......................................*...............................................................................................................
        // smulwb r14, r11, r5                        // .......................................*..............................................................................................................
        // smulwt r5, r11, r5                         // .......................................*..............................................................................................................
        // smlabt r14, r14, r12, r0                   // ........................................*.............................................................................................................
        // smlabt r5, r5, r12, r0                     // ........................................*.............................................................................................................
        // pkhtb r14, r5, r14, asr#16                 // .........................................*............................................................................................................
        // usub16 r5, r4, r14                         // .........................................*............................................................................................................
        // uadd16 r4, r4, r14                         // ..........................................*...........................................................................................................
        // vmov r10, s13                              // ..........................................*...........................................................................................................
        // vmov r11, s14                              // ...........................................*..........................................................................................................
        // smulwb r14, r10, r7                        // ...........................................*..........................................................................................................
        // smulwt r7, r10, r7                         // ............................................*.........................................................................................................
        // smlabt r14, r14, r12, r0                   // ............................................*.........................................................................................................
        // smlabt r7, r7, r12, r0                     // .............................................*........................................................................................................
        // pkhtb r14, r7, r14, asr#16                 // .............................................*........................................................................................................
        // usub16 r7, r6, r14                         // ..............................................*.......................................................................................................
        // uadd16 r6, r6, r14                         // ..............................................*.......................................................................................................
        // smulwb r14, r11, r9                        // ...............................................*......................................................................................................
        // smulwt r9, r11, r9                         // ...............................................*......................................................................................................
        // smlabt r14, r14, r12, r0                   // ................................................*.....................................................................................................
        // smlabt r9, r9, r12, r0                     // ................................................*.....................................................................................................
        // pkhtb r14, r9, r14, asr#16                 // .................................................*....................................................................................................
        // usub16 r9, r8, r14                         // .................................................*....................................................................................................
        // uadd16 r8, r8, r14                         // ..................................................*...................................................................................................
        // vmov r10, s15                              // ..................................................*...................................................................................................
        // vmov r11, s16                              // ...................................................*..................................................................................................
        // smulwb r14, r10, r2                        // ...................................................*..................................................................................................
        // smulwt r2,   r10, r2                       // ....................................................*.................................................................................................
        // smlabt r14, r14, r12, r0                   // ....................................................*.................................................................................................
        // smlabt r2, r2, r12, r0                     // .....................................................*................................................................................................
        // pkhtb r2, r2, r14, asr#16                  // .....................................................*................................................................................................
        // smulwb r14, r11, r3                        // ......................................................*...............................................................................................
        // smulwt r3,   r11, r3                       // ......................................................*...............................................................................................
        // smlabt r14, r14, r12, r0                   // .......................................................*..............................................................................................
        // smlabt r3, r3, r12, r0                     // .......................................................*..............................................................................................
        // pkhtb r3, r3, r14, asr#16                  // ........................................................*.............................................................................................
        // vmov r10, s17                              // ........................................................*.............................................................................................
        // vmov r11, s18                              // .........................................................*............................................................................................
        // smulwb r14, r10, r4                        // .........................................................*............................................................................................
        // smulwt r4,   r10, r4                       // ..........................................................*...........................................................................................
        // smlabt r14, r14, r12, r0                   // ..........................................................*...........................................................................................
        // smlabt r4, r4, r12, r0                     // ...........................................................*..........................................................................................
        // pkhtb r4, r4, r14, asr#16                  // ...........................................................*..........................................................................................
        // smulwb r14, r11, r5                        // ............................................................*.........................................................................................
        // smulwt r5,   r11, r5                       // ............................................................*.........................................................................................
        // smlabt r14, r14, r12, r0                   // .............................................................*........................................................................................
        // smlabt r5, r5, r12, r0                     // .............................................................*........................................................................................
        // pkhtb r5, r5, r14, asr#16                  // ..............................................................*.......................................................................................
        // vmov r10, s19                              // ..............................................................*.......................................................................................
        // vmov r11, s20                              // ...............................................................*......................................................................................
        // smulwb r14, r10, r6                        // ...............................................................*......................................................................................
        // smulwt r6,   r10, r6                       // ................................................................*.....................................................................................
        // smlabt r14, r14, r12, r0                   // ................................................................*.....................................................................................
        // smlabt r6, r6, r12, r0                     // .................................................................*....................................................................................
        // pkhtb r6, r6, r14, asr#16                  // .................................................................*....................................................................................
        // smulwb r14, r11, r7                        // ..................................................................*...................................................................................
        // smulwt r7,   r11, r7                       // ..................................................................*...................................................................................
        // smlabt r14, r14, r12, r0                   // ...................................................................*..................................................................................
        // smlabt r7, r7, r12, r0                     // ...................................................................*..................................................................................
        // pkhtb r7, r7, r14, asr#16                  // ....................................................................*.................................................................................
        // vmov r10, s21                              // ....................................................................*.................................................................................
        // vmov r11, s22                              // .....................................................................*................................................................................
        // smulwb r14, r10, r8                        // .....................................................................*................................................................................
        // smulwt r8,   r10, r8                       // ......................................................................*...............................................................................
        // smlabt r14, r14, r12, r0                   // ......................................................................*...............................................................................
        // smlabt r8, r8, r12, r0                     // .......................................................................*..............................................................................
        // pkhtb r8, r8, r14, asr#16                  // .......................................................................*..............................................................................
        // smulwb r14, r11, r9                        // ........................................................................*.............................................................................
        // smulwt r9,   r11, r9                       // ........................................................................*.............................................................................
        // smlabt r14, r14, r12, r0                   // .........................................................................*............................................................................
        // smlabt r9, r9, r12, r0                     // .........................................................................*............................................................................
        // pkhtb r9, r9, r14, asr#16                  // ..........................................................................*...........................................................................
        // vmov s0, r2                                // ..........................................................................*...........................................................................
        // vmov s1, r3                                // ...........................................................................*..........................................................................
        // vmov s2, r4                                // ...........................................................................*..........................................................................
        // vmov s3, r5                                // ............................................................................*.........................................................................
        // vmov s4, r6                                // ............................................................................*.........................................................................
        // vmov s5, r7                                // .............................................................................*........................................................................
        // vmov s6, r8                                // .............................................................................*........................................................................
        // vmov s7, r9                                // ..............................................................................*.......................................................................
        // vmov r0, s23                               // ..............................................................................*.......................................................................
        // ldr.w r2, [r0, #0]                         // ...............................................................................*......................................................................
        // ldr.w r3, [r0, #distance/4]                // ...............................................................................*......................................................................
        // ldr.w r4, [r0, #2*distance/4]              // ................................................................................*.....................................................................
        // ldr.w r5, [r0, #3*distance/4]              // ................................................................................*.....................................................................
        // ldr.w r6, [r0, #distance]                  // .................................................................................*....................................................................
        // ldr.w r7, [r0, #5*distance/4]              // .................................................................................*....................................................................
        // ldr.w r8, [r0, #6*distance/4]              // ..................................................................................*...................................................................
        // ldr.w r9, [r0, #7*distance/4]              // ..................................................................................*...................................................................
        // movw r0, #26632                            // ...................................................................................*..................................................................
        // vmov r10, s8                               // ...................................................................................*..................................................................
        // smulwb r14, r10, r6                        // ....................................................................................*.................................................................
        // smulwt r6, r10, r6                         // ....................................................................................*.................................................................
        // smlabt r14, r14, r12, r0                   // .....................................................................................*................................................................
        // smlabt r6, r6, r12, r0                     // .....................................................................................*................................................................
        // pkhtb r14, r6, r14, asr#16                 // ......................................................................................*...............................................................
        // usub16 r6, r2, r14                         // ......................................................................................*...............................................................
        // uadd16 r2, r2, r14                         // .......................................................................................*..............................................................
        // smulwb r14, r10, r7                        // .......................................................................................*..............................................................
        // smulwt r7, r10, r7                         // ........................................................................................*.............................................................
        // smlabt r14, r14, r12, r0                   // ........................................................................................*.............................................................
        // smlabt r7, r7, r12, r0                     // .........................................................................................*............................................................
        // pkhtb r14, r7, r14, asr#16                 // .........................................................................................*............................................................
        // usub16 r7, r3, r14                         // ..........................................................................................*...........................................................
        // uadd16 r3, r3, r14                         // ..........................................................................................*...........................................................
        // smulwb r14, r10, r8                        // ...........................................................................................*..........................................................
        // smulwt r8, r10, r8                         // ...........................................................................................*..........................................................
        // smlabt r14, r14, r12, r0                   // ............................................................................................*.........................................................
        // smlabt r8, r8, r12, r0                     // ............................................................................................*.........................................................
        // pkhtb r14, r8, r14, asr#16                 // .............................................................................................*........................................................
        // usub16 r8, r4, r14                         // .............................................................................................*........................................................
        // uadd16 r4, r4, r14                         // ..............................................................................................*.......................................................
        // smulwb r14, r10, r9                        // ..............................................................................................*.......................................................
        // smulwt r9, r10, r9                         // ...............................................................................................*......................................................
        // smlabt r14, r14, r12, r0                   // ...............................................................................................*......................................................
        // smlabt r9, r9, r12, r0                     // ................................................................................................*.....................................................
        // pkhtb r14, r9, r14, asr#16                 // ................................................................................................*.....................................................
        // usub16 r9, r5, r14                         // .................................................................................................*....................................................
        // uadd16 r5, r5, r14                         // .................................................................................................*....................................................
        // vmov r10, s9                               // ..................................................................................................*...................................................
        // vmov r11, s10                              // ..................................................................................................*...................................................
        // smulwb r14, r10, r4                        // ...................................................................................................*..................................................
        // smulwt r4, r10, r4                         // ...................................................................................................*..................................................
        // smlabt r14, r14, r12, r0                   // ....................................................................................................*.................................................
        // smlabt r4, r4, r12, r0                     // ....................................................................................................*.................................................
        // pkhtb r14, r4, r14, asr#16                 // .....................................................................................................*................................................
        // usub16 r4, r2, r14                         // .....................................................................................................*................................................
        // uadd16 r2, r2, r14                         // ......................................................................................................*...............................................
        // smulwb r14, r10, r5                        // ......................................................................................................*...............................................
        // smulwt r5, r10, r5                         // .......................................................................................................*..............................................
        // smlabt r14, r14, r12, r0                   // .......................................................................................................*..............................................
        // smlabt r5, r5, r12, r0                     // ........................................................................................................*.............................................
        // pkhtb r14, r5, r14, asr#16                 // ........................................................................................................*.............................................
        // usub16 r5, r3, r14                         // .........................................................................................................*............................................
        // uadd16 r3, r3, r14                         // .........................................................................................................*............................................
        // smulwb r14, r11, r8                        // ..........................................................................................................*...........................................
        // smulwt r8, r11, r8                         // ..........................................................................................................*...........................................
        // smlabt r14, r14, r12, r0                   // ...........................................................................................................*..........................................
        // smlabt r8, r8, r12, r0                     // ...........................................................................................................*..........................................
        // pkhtb r14, r8, r14, asr#16                 // ............................................................................................................*.........................................
        // usub16 r8, r6, r14                         // ............................................................................................................*.........................................
        // uadd16 r6, r6, r14                         // .............................................................................................................*........................................
        // smulwb r14, r11, r9                        // .............................................................................................................*........................................
        // smulwt r9, r11, r9                         // ..............................................................................................................*.......................................
        // smlabt r14, r14, r12, r0                   // ..............................................................................................................*.......................................
        // smlabt r9, r9, r12, r0                     // ...............................................................................................................*......................................
        // pkhtb r14, r9, r14, asr#16                 // ...............................................................................................................*......................................
        // usub16 r9, r7, r14                         // ................................................................................................................*.....................................
        // uadd16 r7, r7, r14                         // ................................................................................................................*.....................................
        // vmov r10, s11                              // .................................................................................................................*....................................
        // vmov r11, s12                              // .................................................................................................................*....................................
        // smulwb r14, r10, r3                        // ..................................................................................................................*...................................
        // smulwt r3, r10, r3                         // ..................................................................................................................*...................................
        // smlabt r14, r14, r12, r0                   // ...................................................................................................................*..................................
        // smlabt r3, r3, r12, r0                     // ...................................................................................................................*..................................
        // pkhtb r14, r3, r14, asr#16                 // ....................................................................................................................*.................................
        // usub16 r3, r2, r14                         // ....................................................................................................................*.................................
        // uadd16 r2, r2, r14                         // .....................................................................................................................*................................
        // smulwb r14, r11, r5                        // .....................................................................................................................*................................
        // smulwt r5, r11, r5                         // ......................................................................................................................*...............................
        // smlabt r14, r14, r12, r0                   // ......................................................................................................................*...............................
        // smlabt r5, r5, r12, r0                     // .......................................................................................................................*..............................
        // pkhtb r14, r5, r14, asr#16                 // .......................................................................................................................*..............................
        // usub16 r5, r4, r14                         // ........................................................................................................................*.............................
        // uadd16 r4, r4, r14                         // ........................................................................................................................*.............................
        // vmov r10, s13                              // .........................................................................................................................*............................
        // vmov r11, s14                              // .........................................................................................................................*............................
        // smulwb r14, r10, r7                        // ..........................................................................................................................*...........................
        // smulwt r7, r10, r7                         // ..........................................................................................................................*...........................
        // smlabt r14, r14, r12, r0                   // ...........................................................................................................................*..........................
        // smlabt r7, r7, r12, r0                     // ...........................................................................................................................*..........................
        // pkhtb r14, r7, r14, asr#16                 // ............................................................................................................................*.........................
        // usub16 r7, r6, r14                         // ............................................................................................................................*.........................
        // uadd16 r6, r6, r14                         // .............................................................................................................................*........................
        // smulwb r14, r11, r9                        // .............................................................................................................................*........................
        // smulwt r9, r11, r9                         // ..............................................................................................................................*.......................
        // smlabt r14, r14, r12, r0                   // ..............................................................................................................................*.......................
        // smlabt r9, r9, r12, r0                     // ...............................................................................................................................*......................
        // pkhtb r14, r9, r14, asr#16                 // ...............................................................................................................................*......................
        // usub16 r9, r8, r14                         // ................................................................................................................................*.....................
        // uadd16 r8, r8, r14                         // ................................................................................................................................*.....................
        // vmov r0, s23                               // .................................................................................................................................*....................
        // vmov r10, s1                               // .................................................................................................................................*....................
        // uadd16 r14, r3, r10                        // ..................................................................................................................................*...................
        // usub16 r3, r3, r10                         // ..................................................................................................................................*...................
        // str.w r14, [r0, #1*distance/4]             // ...................................................................................................................................*..................
        // str.w r3, [r0, #1*distance/4+offset]       // ...................................................................................................................................*..................
        // vmov r10, s3                               // ....................................................................................................................................*.................
        // uadd16 r14, r5, r10                        // ....................................................................................................................................*.................
        // usub16 r5, r5, r10                         // .....................................................................................................................................*................
        // str.w r14, [r0, #3*distance/4]             // .....................................................................................................................................*................
        // str.w r5, [r0, #3*distance/4+offset]       // ......................................................................................................................................*...............
        // vmov r10, s5                               // ......................................................................................................................................*...............
        // uadd16 r14, r7, r10                        // .......................................................................................................................................*..............
        // usub16 r7, r7, r10                         // .......................................................................................................................................*..............
        // str.w r14, [r0, #5*distance/4]             // ........................................................................................................................................*.............
        // str.w r7, [r0, #5*distance/4+offset]       // ........................................................................................................................................*.............
        // vmov r10, s7                               // .........................................................................................................................................*............
        // uadd16 r14, r9, r10                        // .........................................................................................................................................*............
        // usub16 r9, r9, r10                         // ..........................................................................................................................................*...........
        // str.w r14, [r0, #7*distance/4]             // ..........................................................................................................................................*...........
        // str.w r9, [r0, #7*distance/4+offset]       // ...........................................................................................................................................*..........
        // vmov r5, s2                                // ...........................................................................................................................................*..........
        // uadd16 r14, r4, r5                         // ............................................................................................................................................*.........
        // usub16 r10, r4, r5                         // ............................................................................................................................................*.........
        // str.w r14, [r0, #2*distance/4]             // .............................................................................................................................................*........
        // str.w r10, [r0, #2*distance/4+offset]      // .............................................................................................................................................*........
        // vmov r7, s4                                // ..............................................................................................................................................*.......
        // uadd16 r14, r6, r7                         // ..............................................................................................................................................*.......
        // usub16 r10, r6, r7                         // ...............................................................................................................................................*......
        // str.w r14, [r0, #4*distance/4]             // ...............................................................................................................................................*......
        // str.w r10, [r0, #4*distance/4+offset]      // ................................................................................................................................................*.....
        // vmov r9, s6                                // ................................................................................................................................................*.....
        // uadd16 r14, r8, r9                         // .................................................................................................................................................*....
        // usub16 r10, r8, r9                         // .................................................................................................................................................*....
        // str.w r14, [r0, #6*distance/4]             // ..................................................................................................................................................*...
        // str.w r10, [r0, #6*distance/4+offset]      // ..................................................................................................................................................*...
        // vmov r3, s0                                // ...................................................................................................................................................*..
        // uadd16 r14, r2, r3                         // ...................................................................................................................................................*..
        // usub16 r10, r2, r3                         // ....................................................................................................................................................*.
        // str.w r10, [r0, #offset]                   // ....................................................................................................................................................*.
        // str.w r14, [r0], #4                        // .....................................................................................................................................................*
        // vmov r14, s24                              // .....................................................................................................................................................*

        layer1234_end:

 cmp.w poly, tmp
 bne.w 1b

 sub.w poly, #8*strincr

 ### LAYER 3+2+1

 .equ distance, distance/16
 .equ strincr, 32

 add.w tmp, poly, #strincr*16
 vmov s13, tmp
 2:
        layer567_start:
                                              // Instructions:    108
                                              // Expected cycles: 54
                                              // Expected IPC:    2.00
                                              //
                                              // Wall time:     13.95s
                                              // User time:     13.95s
                                              //
                                              // ----------------- cycle (expected) ------------------>
                                              // 0                        25                       50
                                              // |------------------------|------------------------|---
        ldr.w r9, [r0, #0]                    // *.....................................................
        vmov s6, r0                           // *.....................................................
        ldr.w r3, [r0, #distance/4]           // .*....................................................
        ldr.w r4, [r0, #2*distance/4]         // .*....................................................
        ldr.w r2, [r0, #3*distance/4]         // ..*...................................................
        ldr.w r6, [r0, #distance]             // ..*...................................................
        ldr.w r11, [r0, #5*distance/4]        // ...*..................................................
        ldr.w r8, [r0, #6*distance/4]         // ...*..................................................
        ldr.w r5, [r0, #7*distance/4]         // ....*.................................................
        movw r14, #26632                      // ....*.................................................
        ldr.w r0, [r1], #4                    // .....*................................................
        smulwb r10, r0, r6                    // .....*................................................
        smulwt r6, r0, r6                     // ......*...............................................
        smlabt r7, r10, r12, r14              // ......*...............................................
        smlabt r6, r6, r12, r14               // .......*..............................................
        pkhtb r10, r6, r7, asr#16             // .......*..............................................
        usub16 r6, r9, r10                    // ........*.............................................
        uadd16 r10, r9, r10                   // ........*.............................................
        smulwb r9, r0, r11                    // .........*............................................
        smulwt r7, r0, r11                    // .........*............................................
        smlabt r11, r9, r12, r14              // ..........*...........................................
        smlabt r7, r7, r12, r14               // ..........*...........................................
        pkhtb r9, r7, r11, asr#16             // ...........*..........................................
        usub16 r11, r3, r9                    // ...........*..........................................
        uadd16 r7, r3, r9                     // ............*.........................................
        smulwb r9, r0, r8                     // ............*.........................................
        smulwt r3, r0, r8                     // .............*........................................
        smlabt r8, r9, r12, r14               // .............*........................................
        smlabt r3, r3, r12, r14               // ..............*.......................................
        pkhtb r9, r3, r8, asr#16              // ..............*.......................................
        usub16 r3, r4, r9                     // ...............*......................................
        smulwb r8, r0, r5                     // ...............*......................................
        smulwt r0, r0, r5                     // ................*.....................................
        smlabt r5, r8, r12, r14               // ................*.....................................
        smlabt r8, r0, r12, r14               // .................*....................................
        pkhtb r0, r8, r5, asr#16              // .................*....................................
        uadd16 r8, r4, r9                     // ..................*...................................
        usub16 r9, r2, r0                     // ..................*...................................
        uadd16 r2, r2, r0                     // ...................*..................................
        ldrd r0, r4, [r1], #8                 // ...................*..................................
        smulwb r5, r0, r8                     // ....................*.................................
        smulwt r8, r0, r8                     // ....................*.................................
        smlabt r5, r5, r12, r14               // .....................*................................
        smlabt r8, r8, r12, r14               // .....................*................................
        pkhtb r5, r8, r5, asr#16              // ......................*...............................
        usub16 r8, r10, r5                    // ......................*...............................
        uadd16 r10, r10, r5                   // .......................*..............................
        smulwb r5, r0, r2                     // .......................*..............................
        smulwt r2, r0, r2                     // ........................*.............................
        smlabt r5, r5, r12, r14               // ........................*.............................
        smlabt r2, r2, r12, r14               // .........................*............................
        pkhtb r2, r2, r5, asr#16              // .........................*............................
        usub16 r5, r7, r2                     // ..........................*...........................
        uadd16 r7, r7, r2                     // ..........................*...........................
        smulwb r2, r4, r3                     // ...........................*..........................
        smulwt r3, r4, r3                     // ...........................*..........................
        smlabt r0, r2, r12, r14               // ............................*.........................
        smlabt r2, r3, r12, r14               // ............................*.........................
        pkhtb r2, r2, r0, asr#16              // .............................*........................
        usub16 r0, r6, r2                     // .............................*........................
        uadd16 r2, r6, r2                     // ..............................*.......................
        smulwb r6, r4, r9                     // ..............................*.......................
        smulwt r3, r4, r9                     // ...............................*......................
        smlabt r4, r6, r12, r14               // ...............................*......................
        smlabt r3, r3, r12, r14               // ................................*.....................
        pkhtb r3, r3, r4, asr#16              // ................................*.....................
        usub16 r9, r11, r3                    // .................................*....................
        uadd16 r6, r11, r3                    // .................................*....................
        ldrd r3, r11, [r1], #8                // ..................................*...................
        smulwb r4, r3, r7                     // ..................................*...................
        smulwt r3, r3, r7                     // ...................................*..................
        smlabt r4, r4, r12, r14               // ...................................*..................
        smlabt r3, r3, r12, r14               // ....................................*.................
        pkhtb r3, r3, r4, asr#16              // ....................................*.................
        usub16 r7, r10, r3                    // .....................................*................
        uadd16 r10, r10, r3                   // .....................................*................
        smulwb r4, r11, r5                    // ......................................*...............
        smulwt r3, r11, r5                    // ......................................*...............
        smlabt r4, r4, r12, r14               // .......................................*..............
        smlabt r3, r3, r12, r14               // .......................................*..............
        pkhtb r3, r3, r4, asr#16              // ........................................*.............
        usub16 r5, r8, r3                     // ........................................*.............
        uadd16 r8, r8, r3                     // .........................................*............
        ldrd r3, r11, [r1], #8                // .........................................*............
        smulwb r4, r3, r6                     // ..........................................*...........
        smulwt r3, r3, r6                     // ..........................................*...........
        smlabt r4, r4, r12, r14               // ...........................................*..........
        smlabt r3, r3, r12, r14               // ...........................................*..........
        pkhtb r3, r3, r4, asr#16              // ............................................*.........
        usub16 r6, r2, r3                     // ............................................*.........
        uadd16 r2, r2, r3                     // .............................................*........
        smulwb r4, r11, r9                    // .............................................*........
        smulwt r3, r11, r9                    // ..............................................*.......
        smlabt r4, r4, r12, r14               // ..............................................*.......
        smlabt r3, r3, r12, r14               // ...............................................*......
        pkhtb r3, r3, r4, asr#16              // ...............................................*......
        usub16 r4, r0, r3                     // ................................................*.....
        uadd16 r3, r0, r3                     // ................................................*.....
        vmov r0, s6                           // .................................................*....
        str.w r2, [r0, #distance]             // .................................................*....
        str.w r6, [r0, #5*distance/4]         // ..................................................*...
        str.w r5, [r0, #3*distance/4]         // ..................................................*...
        str.w r3, [r0, #6*distance/4]         // ...................................................*..
        str.w r7, [r0, #distance/4]           // ...................................................*..
        str.w r8, [r0, #2*distance/4]         // ....................................................*.
        str.w r4, [r0, #7*distance/4]         // ....................................................*.
        vmov r14, s13                         // .....................................................*
        str.w r10, [r0], #strincr             // .....................................................*

                                              // ----------------- cycle (expected) ------------------>
                                              // 0                        25                       50
                                              // |------------------------|------------------------|---
        // vmov s23, r0                       // *.....................................................
        // ldr.w r2, [r0, #0]                 // *.....................................................
        // ldr.w r3, [r0, #distance/4]        // .*....................................................
        // ldr.w r4, [r0, #2*distance/4]      // .*....................................................
        // ldr.w r5, [r0, #3*distance/4]      // ..*...................................................
        // ldr.w r6, [r0, #distance]          // ..*...................................................
        // ldr.w r7, [r0, #5*distance/4]      // ...*..................................................
        // ldr.w r8, [r0, #6*distance/4]      // ...*..................................................
        // ldr.w r9, [r0, #7*distance/4]      // ....*.................................................
        // movw r0, #26632                    // ....*.................................................
        // ldr.w r10, [r1], #4                // .....*................................................
        // smulwb r14, r10, r6                // .....*................................................
        // smulwt r6, r10, r6                 // ......*...............................................
        // smlabt r14, r14, r12, r0           // ......*...............................................
        // smlabt r6, r6, r12, r0             // .......*..............................................
        // pkhtb r14, r6, r14, asr#16         // .......*..............................................
        // usub16 r6, r2, r14                 // ........*.............................................
        // uadd16 r2, r2, r14                 // ........*.............................................
        // smulwb r14, r10, r7                // .........*............................................
        // smulwt r7, r10, r7                 // .........*............................................
        // smlabt r14, r14, r12, r0           // ..........*...........................................
        // smlabt r7, r7, r12, r0             // ..........*...........................................
        // pkhtb r14, r7, r14, asr#16         // ...........*..........................................
        // usub16 r7, r3, r14                 // ...........*..........................................
        // uadd16 r3, r3, r14                 // ............*.........................................
        // smulwb r14, r10, r8                // ............*.........................................
        // smulwt r8, r10, r8                 // .............*........................................
        // smlabt r14, r14, r12, r0           // .............*........................................
        // smlabt r8, r8, r12, r0             // ..............*.......................................
        // pkhtb r14, r8, r14, asr#16         // ..............*.......................................
        // usub16 r8, r4, r14                 // ...............*......................................
        // uadd16 r4, r4, r14                 // ..................*...................................
        // smulwb r14, r10, r9                // ...............*......................................
        // smulwt r9, r10, r9                 // ................*.....................................
        // smlabt r14, r14, r12, r0           // ................*.....................................
        // smlabt r9, r9, r12, r0             // .................*....................................
        // pkhtb r14, r9, r14, asr#16         // .................*....................................
        // usub16 r9, r5, r14                 // ..................*...................................
        // uadd16 r5, r5, r14                 // ...................*..................................
        // ldrd r10, r11, [r1], #8            // ...................*..................................
        // smulwb r14, r10, r4                // ....................*.................................
        // smulwt r4, r10, r4                 // ....................*.................................
        // smlabt r14, r14, r12, r0           // .....................*................................
        // smlabt r4, r4, r12, r0             // .....................*................................
        // pkhtb r14, r4, r14, asr#16         // ......................*...............................
        // usub16 r4, r2, r14                 // ......................*...............................
        // uadd16 r2, r2, r14                 // .......................*..............................
        // smulwb r14, r10, r5                // .......................*..............................
        // smulwt r5, r10, r5                 // ........................*.............................
        // smlabt r14, r14, r12, r0           // ........................*.............................
        // smlabt r5, r5, r12, r0             // .........................*............................
        // pkhtb r14, r5, r14, asr#16         // .........................*............................
        // usub16 r5, r3, r14                 // ..........................*...........................
        // uadd16 r3, r3, r14                 // ..........................*...........................
        // smulwb r14, r11, r8                // ...........................*..........................
        // smulwt r8, r11, r8                 // ...........................*..........................
        // smlabt r14, r14, r12, r0           // ............................*.........................
        // smlabt r8, r8, r12, r0             // ............................*.........................
        // pkhtb r14, r8, r14, asr#16         // .............................*........................
        // usub16 r8, r6, r14                 // .............................*........................
        // uadd16 r6, r6, r14                 // ..............................*.......................
        // smulwb r14, r11, r9                // ..............................*.......................
        // smulwt r9, r11, r9                 // ...............................*......................
        // smlabt r14, r14, r12, r0           // ...............................*......................
        // smlabt r9, r9, r12, r0             // ................................*.....................
        // pkhtb r14, r9, r14, asr#16         // ................................*.....................
        // usub16 r9, r7, r14                 // .................................*....................
        // uadd16 r7, r7, r14                 // .................................*....................
        // ldrd r10, r11, [r1], #8            // ..................................*...................
        // smulwb r14, r10, r3                // ..................................*...................
        // smulwt r3, r10, r3                 // ...................................*..................
        // smlabt r14, r14, r12, r0           // ...................................*..................
        // smlabt r3, r3, r12, r0             // ....................................*.................
        // pkhtb r14, r3, r14, asr#16         // ....................................*.................
        // usub16 r3, r2, r14                 // .....................................*................
        // uadd16 r2, r2, r14                 // .....................................*................
        // smulwb r14, r11, r5                // ......................................*...............
        // smulwt r5, r11, r5                 // ......................................*...............
        // smlabt r14, r14, r12, r0           // .......................................*..............
        // smlabt r5, r5, r12, r0             // .......................................*..............
        // pkhtb r14, r5, r14, asr#16         // ........................................*.............
        // usub16 r5, r4, r14                 // ........................................*.............
        // uadd16 r4, r4, r14                 // .........................................*............
        // ldrd r10, r11, [r1], #8            // .........................................*............
        // smulwb r14, r10, r7                // ..........................................*...........
        // smulwt r7, r10, r7                 // ..........................................*...........
        // smlabt r14, r14, r12, r0           // ...........................................*..........
        // smlabt r7, r7, r12, r0             // ...........................................*..........
        // pkhtb r14, r7, r14, asr#16         // ............................................*.........
        // usub16 r7, r6, r14                 // ............................................*.........
        // uadd16 r6, r6, r14                 // .............................................*........
        // smulwb r14, r11, r9                // .............................................*........
        // smulwt r9, r11, r9                 // ..............................................*.......
        // smlabt r14, r14, r12, r0           // ..............................................*.......
        // smlabt r9, r9, r12, r0             // ...............................................*......
        // pkhtb r14, r9, r14, asr#16         // ...............................................*......
        // usub16 r9, r8, r14                 // ................................................*.....
        // uadd16 r8, r8, r14                 // ................................................*.....
        // vmov r0, s23                       // .................................................*....
        // str.w r6, [r0, #distance]          // .................................................*....
        // str.w r7, [r0, #5*distance/4]      // ..................................................*...
        // str.w r8, [r0, #6*distance/4]      // ...................................................*..
        // str.w r9, [r0, #7*distance/4]      // ....................................................*.
        // str.w r3, [r0, #distance/4]        // ...................................................*..
        // str.w r4, [r0, #2*distance/4]      // ....................................................*.
        // str.w r5, [r0, #3*distance/4]      // ..................................................*...
        // str.w r2, [r0], #strincr           // .....................................................*
        // vmov r14, s13                      // .....................................................*

        layer567_end:

 cmp.w poly, tmp
 bne.w 2b
 vpop.w {s16-s24}
 pop {r4-r11, pc}