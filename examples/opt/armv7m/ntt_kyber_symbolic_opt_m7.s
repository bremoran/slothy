/******************************************************************************
* Integrating the improved Plantard arithmetic into Kyber.
*
* Efficient Plantard arithmetic enables a faster Kyber implementation with the
* same stack usage.
*
* See the paper at https:// eprint.iacr.org/2022/956.pdf for more details.
*
* // author   Junhao Huang, BNU-HKBU United International College, Zhuhai, China
*           jhhuang_nuaa// 126.com
*
* // date     September 2022
******************************************************************************/
.syntax unified
.cpu cortex-m4
.thumb

.macro load a, a0, a1, a2, a3, mem0, mem1, mem2, mem3
  ldr.w \a0, [\a, \mem0]
  ldr.w \a1, [\a, \mem1]
  ldr.w \a2, [\a, \mem2]
  ldr.w \a3, [\a, \mem3]
.endm

.macro store a, a0, a1, a2, a3, mem0, mem1, mem2, mem3
  str.w \a0, [\a, \mem0]
  str.w \a1, [\a, \mem1]
  str.w \a2, [\a, \mem2]
  str.w \a3, [\a, \mem3]
.endm

.macro doubleplant a, tmp, q, qa, plantconst
 smulwb \tmp, \plantconst, \a
 smulwt \a, \plantconst, \a
 smlabt \tmp, \tmp, \q, \qa
 smlabt \a, \a, \q, \qa
 pkhtb \a, \a, \tmp, asr #16
.endm

.macro doublebarrett a, tmp, tmp2, q, barrettconst
  smulbb \tmp, \a, \barrettconst
  smultb \tmp2, \a, \barrettconst
  asr \tmp, \tmp, #26
  asr \tmp2, \tmp2, #26
  smulbb \tmp, \tmp, \q
  smulbb \tmp2, \tmp2, \q
  pkhbt \tmp, \tmp, \tmp2, lsl #16
  usub16 \a, \a, \tmp
.endm

// q locate in the top half of the register
.macro plant_red q, qa, qinv, tmp
 mul \tmp, \tmp, \qinv
 // tmp*qinv mod 2^2n/ 2^n; in high half
 smlatt \tmp, \tmp, \q, \qa
 // result in high half
.endm

.macro mul_twiddle_plant a, twiddle, tmp, q, qa
 smulwb \tmp, \twiddle, \a
 smulwt \a,   \twiddle, \a
 smlabt \tmp, \tmp, \q, \qa
 smlabt \a, \a, \q, \qa
 pkhtb \a, \a, \tmp, asr #16
.endm

.macro doublebutterfly_plant a0, a1, twiddle, tmp, q, qa
 smulwb \tmp, \twiddle, \a1
 smulwt \a1, \twiddle, \a1
 smlabt \tmp, \tmp, \q, \qa
 smlabt \a1, \a1, \q, \qa
 pkhtb \tmp, \a1, \tmp, asr #16
 usub16 \a1, \a0, \tmp
 uadd16 \a0, \a0, \tmp
.endm

.macro two_doublebutterfly_plant a0, a1, a2, a3, twiddle0, twiddle1, tmp, q, qa
 doublebutterfly_plant \a0, \a1, \twiddle0, \tmp, \q, \qa
 doublebutterfly_plant \a2, \a3, \twiddle1, \tmp, \q, \qa
.endm

.macro _3_layer_double_CT_16_plant c0, c1, c2, c3, c4, c5, c6, c7, twiddle1, twiddle2, twiddle_ptr, q, qa, tmp
 // layer 3
 ldr.w \twiddle1, [\twiddle_ptr], #4
 two_doublebutterfly_plant \c0, \c4, \c1, \c5, \twiddle1, \twiddle1, \tmp, \q, \qa
 two_doublebutterfly_plant \c2, \c6, \c3, \c7, \twiddle1, \twiddle1, \tmp, \q, \qa

 // layer 2
 ldrd \twiddle1, \twiddle2, [\twiddle_ptr], #8
 two_doublebutterfly_plant \c0, \c2, \c1, \c3, \twiddle1, \twiddle1, \tmp, \q, \qa

 two_doublebutterfly_plant \c4, \c6, \c5, \c7, \twiddle2, \twiddle2, \tmp, \q, \qa

 // layer 1
 ldrd \twiddle1, \twiddle2, [\twiddle_ptr], #8
 two_doublebutterfly_plant \c0, \c1, \c2, \c3, \twiddle1, \twiddle2, \tmp, \q, \qa

 ldrd \twiddle1, \twiddle2, [\twiddle_ptr], #8
 two_doublebutterfly_plant \c4, \c5, \c6, \c7, \twiddle1, \twiddle2, \tmp, \q, \qa
.endm

.macro _3_layer_double_CT_16_plant_fp c0, c1, c2, c3, c4, c5, c6, c7, xi0, xi1, xi2, xi3, xi4, xi5, xi6, twiddle1, twiddle2, q, qa, tmp
 // layer 3
 vmov \twiddle1, \xi0
 two_doublebutterfly_plant \c0, \c4, \c1, \c5, \twiddle1, \twiddle1, \tmp, \q, \qa
 two_doublebutterfly_plant \c2, \c6, \c3, \c7, \twiddle1, \twiddle1, \tmp, \q, \qa

 // layer 2
 vmov \twiddle1, \xi1
 vmov \twiddle2, \xi2
 two_doublebutterfly_plant \c0, \c2, \c1, \c3, \twiddle1, \twiddle1, \tmp, \q, \qa

 two_doublebutterfly_plant \c4, \c6, \c5, \c7, \twiddle2, \twiddle2, \tmp, \q, \qa

 // layer 1
 vmov \twiddle1, \xi3
 vmov \twiddle2, \xi4
 two_doublebutterfly_plant \c0, \c1, \c2, \c3, \twiddle1, \twiddle2, \tmp, \q, \qa

 vmov \twiddle1, \xi5
 vmov \twiddle2, \xi6
 two_doublebutterfly_plant \c4, \c5, \c6, \c7, \twiddle1, \twiddle2, \tmp, \q, \qa
.endm

#define STACK_SIZE (8*4)
#define STACK_LOC_0 (0*4)
#define STACK_LOC_1 (1*4)
#define STACK_LOC_2 (2*4)
#define STACK_LOC_3 (3*4)
#define STACK_LOC_4 (4*4)
#define STACK_LOC_5 (5*4)
#define STACK_LOC_6 (6*4)
#define STACK_LOC_7 (7*4)
#define STACK_LOC_8 (8*4)

.global ntt_fast_symbolic_opt_m7
.type ntt_fast_symbolic_opt_m7, %function
.align 2
ntt_fast_symbolic_opt_m7:
 push {r4-r11, r14}
 vpush.w {s16-s25}
 poly         .req r0
 twiddle_ptr  .req r1
 twiddle1     .req r10
 twiddle2     .req r11
 ###  qinv        .req r11 ### q^-1 mod 2^2n; n=16
 q           .req r12
 ### at the top of r12
 qa          .req r0
 ### qa=2^a q;a=3; at the bottom of r12
 tmp         .req r14

 sub.w sp, sp, STACK_SIZE

 // movw qa, #26632
 // Why movt? Because we initially placed qa at the bottom of the same register as q;
 movt q, #3329

 ### LAYER 7+6+5+4
 .equ distance, 256
 .equ offset, 32
 .equ strincr, 4
 // pre-load 15 twiddle factors to 15 FPU registers
 // s0-s7 used to temporary store 16 16-bit polys.
 vldm twiddle_ptr!, {s8-s22}
 vmov s25, twiddle_ptr

 add tmp, poly, #strincr*8
 // s23: poly addr
 // s24: tmp
 vmov s24, tmp
 1:
        layer1234_start:
                                                     // Instructions:    284
                                                     // Expected cycles: 142
                                                     // Expected IPC:    2.00
                                                     //
                                                     // Cycle bound:     142.0
                                                     // IPC bound:       2.00
                                                     //
                                                     // Wall time:     300.23s
                                                     // User time:     300.23s
                                                     //
                                                     // ------------------------------------------------------------- cycle (expected) -------------------------------------------------------------->
                                                     // 0                        25                       50                       75                       100                      125
                                                     // |------------------------|------------------------|------------------------|------------------------|------------------------|----------------
        vmov s23, r0                                 // *.............................................................................................................................................
        ldr.w r9, [r0, #offset]                      // *.............................................................................................................................................
        ldr.w r11, [r0, #distance/4+offset]          // .*............................................................................................................................................
        ldr.w r6, [r0, #2*distance/4+offset]         // .*............................................................................................................................................
        ldr.w r10, [r0, #3*distance/4+offset]        // ..*...........................................................................................................................................
        ldr.w r14, [r0, #distance+offset]            // ..*...........................................................................................................................................
        ldr.w r2, [r0, #5*distance/4+offset]         // ...*..........................................................................................................................................
        ldr.w r3, [r0, #6*distance/4+offset]         // ...*..........................................................................................................................................
        ldr.w r5, [r0, #7*distance/4+offset]         // ....*.........................................................................................................................................
        movw r7, #26632                              // ....*.........................................................................................................................................
        vmov r8, s8                                  // .....*........................................................................................................................................
        smulwb r0, r8, r14                           // .....*........................................................................................................................................
        smulwt r14, r8, r14                          // ......*.......................................................................................................................................
        smlabt r0, r0, r12, r7                       // ......*.......................................................................................................................................
        smlabt r14, r14, r12, r7                     // .......*......................................................................................................................................
        pkhtb r14, r14, r0, asr #16                  // .......*......................................................................................................................................
        usub16 r0, r9, r14                           // ........*.....................................................................................................................................
        uadd16 r1, r9, r14                           // ........*.....................................................................................................................................
        smulwb r14, r8, r2                           // .........*....................................................................................................................................
        smulwt r2, r8, r2                            // .........*....................................................................................................................................
        smlabt r9, r14, r12, r7                      // ..........*...................................................................................................................................
        smlabt r2, r2, r12, r7                       // ..........*...................................................................................................................................
        pkhtb r2, r2, r9, asr #16                    // ...........*..................................................................................................................................
        usub16 r4, r11, r2                           // ...........*..................................................................................................................................
        uadd16 r14, r11, r2                          // ............*.................................................................................................................................
        smulwb r2, r8, r3                            // ............*.................................................................................................................................
        smulwt r11, r8, r3                           // .............*................................................................................................................................
        smlabt r2, r2, r12, r7                       // .............*................................................................................................................................
        smlabt r11, r11, r12, r7                     // ..............*...............................................................................................................................
        pkhtb r11, r11, r2, asr #16                  // ..............*...............................................................................................................................
        usub16 r2, r6, r11                           // ...............*..............................................................................................................................
        uadd16 r3, r6, r11                           // ...............*..............................................................................................................................
        smulwb r6, r8, r5                            // ................*.............................................................................................................................
        smulwt r11, r8, r5                           // ................*.............................................................................................................................
        smlabt r6, r6, r12, r7                       // .................*............................................................................................................................
        smlabt r11, r11, r12, r7                     // .................*............................................................................................................................
        pkhtb r11, r11, r6, asr #16                  // ..................*...........................................................................................................................
        usub16 r5, r10, r11                          // ..................*...........................................................................................................................
        uadd16 r8, r10, r11                          // ...................*..........................................................................................................................
        vmov r6, s9                                  // ...................*..........................................................................................................................
        vmov r9, s10                                 // ....................*.........................................................................................................................
        smulwb r10, r6, r3                           // ....................*.........................................................................................................................
        smulwt r11, r6, r3                           // .....................*........................................................................................................................
        smlabt r10, r10, r12, r7                     // .....................*........................................................................................................................
        smlabt r11, r11, r12, r7                     // ......................*.......................................................................................................................
        pkhtb r10, r11, r10, asr #16                 // ......................*.......................................................................................................................
        usub16 r3, r1, r10                           // .......................*......................................................................................................................
        uadd16 r11, r1, r10                          // .......................*......................................................................................................................
        smulwb r10, r6, r8                           // ........................*.....................................................................................................................
        smulwt r6, r6, r8                            // ........................*.....................................................................................................................
        smlabt r10, r10, r12, r7                     // .........................*....................................................................................................................
        smlabt r6, r6, r12, r7                       // .........................*....................................................................................................................
        pkhtb r6, r6, r10, asr #16                   // ..........................*...................................................................................................................
        usub16 r10, r14, r6                          // ..........................*...................................................................................................................
        uadd16 r6, r14, r6                           // ...........................*..................................................................................................................
        smulwb r14, r9, r2                           // ...........................*..................................................................................................................
        smulwt r2, r9, r2                            // ............................*.................................................................................................................
        smlabt r14, r14, r12, r7                     // ............................*.................................................................................................................
        smlabt r2, r2, r12, r7                       // .............................*................................................................................................................
        pkhtb r2, r2, r14, asr #16                   // .............................*................................................................................................................
        usub16 r14, r0, r2                           // ..............................*...............................................................................................................
        uadd16 r8, r0, r2                            // ..............................*...............................................................................................................
        smulwb r0, r9, r5                            // ...............................*..............................................................................................................
        smulwt r2, r9, r5                            // ...............................*..............................................................................................................
        smlabt r5, r0, r12, r7                       // ................................*.............................................................................................................
        smlabt r2, r2, r12, r7                       // ................................*.............................................................................................................
        pkhtb r2, r2, r5, asr #16                    // .................................*............................................................................................................
        usub16 r0, r4, r2                            // .................................*............................................................................................................
        uadd16 r1, r4, r2                            // ..................................*...........................................................................................................
        vmov r5, s11                                 // ..................................*...........................................................................................................
        vmov r4, s12                                 // ...................................*..........................................................................................................
        smulwb r2, r5, r6                            // ...................................*..........................................................................................................
        smulwt r6, r5, r6                            // ....................................*.........................................................................................................
        smlabt r9, r2, r12, r7                       // ....................................*.........................................................................................................
        smlabt r6, r6, r12, r7                       // .....................................*........................................................................................................
        pkhtb r6, r6, r9, asr #16                    // .....................................*........................................................................................................
        usub16 r5, r11, r6                           // ......................................*.......................................................................................................
        uadd16 r6, r11, r6                           // ......................................*.......................................................................................................
        smulwb r2, r4, r10                           // .......................................*......................................................................................................
        smulwt r11, r4, r10                          // .......................................*......................................................................................................
        smlabt r9, r2, r12, r7                       // ........................................*.....................................................................................................
        smlabt r11, r11, r12, r7                     // ........................................*.....................................................................................................
        pkhtb r10, r11, r9, asr #16                  // .........................................*....................................................................................................
        usub16 r2, r3, r10                           // .........................................*....................................................................................................
        uadd16 r3, r3, r10                           // ..........................................*...................................................................................................
        vmov r11, s13                                // ..........................................*...................................................................................................
        vmov r4, s14                                 // ...........................................*..................................................................................................
        smulwb r10, r11, r1                          // ...........................................*..................................................................................................
        smulwt r11, r11, r1                          // ............................................*.................................................................................................
        smlabt r9, r10, r12, r7                      // ............................................*.................................................................................................
        smlabt r11, r11, r12, r7                     // .............................................*................................................................................................
        pkhtb r10, r11, r9, asr #16                  // .............................................*................................................................................................
        usub16 r9, r8, r10                           // ..............................................*...............................................................................................
        uadd16 r1, r8, r10                           // ..............................................*...............................................................................................
        smulwb r10, r4, r0                           // ...............................................*..............................................................................................
        smulwt r11, r4, r0                           // ...............................................*..............................................................................................
        smlabt r10, r10, r12, r7                     // ................................................*.............................................................................................
        smlabt r11, r11, r12, r7                     // ................................................*.............................................................................................
        pkhtb r11, r11, r10, asr #16                 // .................................................*............................................................................................
        usub16 r8, r14, r11                          // .................................................*............................................................................................
        uadd16 r4, r14, r11                          // ..................................................*...........................................................................................
        vmov r11, s15                                // ..................................................*...........................................................................................
        vmov r0, s16                                 // ...................................................*..........................................................................................
        smulwb r10, r11, r6                          // ...................................................*..........................................................................................
        smulwt r11, r11, r6                          // ....................................................*.........................................................................................
        smlabt r6, r10, r12, r7                      // ....................................................*.........................................................................................
        smlabt r11, r11, r12, r7                     // .....................................................*........................................................................................
        pkhtb r10, r11, r6, asr #16                  // .....................................................*........................................................................................
        str r10, [sp, #STACK_LOC_0]                  // .....................................................s........................................................................................ // @slothy:is_spill // @slothy:writes=stack_0
        smulwb r10, r0, r5                           // ......................................................*.......................................................................................
        smulwt r11, r0, r5                           // ......................................................*.......................................................................................
        smlabt r14, r10, r12, r7                     // .......................................................*......................................................................................
        smlabt r11, r11, r12, r7                     // .......................................................*......................................................................................
        pkhtb r6, r11, r14, asr #16                  // ........................................................*.....................................................................................
        str r6, [sp, #STACK_LOC_1]                   // ........................................................s..................................................................................... // @slothy:is_spill // @slothy:writes=stack_1
        vmov r6, s17                                 // ........................................................*.....................................................................................
        vmov r11, s18                                // .........................................................*....................................................................................
        smulwb r10, r6, r3                           // .........................................................*....................................................................................
        smulwt r6, r6, r3                            // ..........................................................*...................................................................................
        smlabt r3, r10, r12, r7                      // ..........................................................*...................................................................................
        smlabt r6, r6, r12, r7                       // ...........................................................*..................................................................................
        pkhtb r6, r6, r3, asr #16                    // ...........................................................*..................................................................................
        str r6, [sp, #STACK_LOC_2]                   // ...........................................................s.................................................................................. // @slothy:is_spill // @slothy:writes=stack_2
        smulwb r6, r11, r2                           // ............................................................*.................................................................................
        smulwt r11, r11, r2                          // ............................................................*.................................................................................
        smlabt r2, r6, r12, r7                       // .............................................................*................................................................................
        smlabt r11, r11, r12, r7                     // .............................................................*................................................................................
        pkhtb r6, r11, r2, asr #16                   // ..............................................................*...............................................................................
        str r6, [sp, #STACK_LOC_3]                   // ..............................................................s............................................................................... // @slothy:is_spill // @slothy:writes=stack_3
        vmov r2, s19                                 // ..............................................................*...............................................................................
        vmov r11, s20                                // ...............................................................*..............................................................................
        smulwb r10, r2, r1                           // ...............................................................*..............................................................................
        smulwt r1, r2, r1                            // ................................................................*.............................................................................
        smlabt r6, r10, r12, r7                      // ................................................................*.............................................................................
        smlabt r1, r1, r12, r7                       // .................................................................*............................................................................
        pkhtb r6, r1, r6, asr #16                    // .................................................................*............................................................................
        str r6, [sp, #STACK_LOC_4]                   // .................................................................s............................................................................ // @slothy:is_spill // @slothy:writes=stack_4
        smulwb r6, r11, r9                           // ..................................................................*...........................................................................
        smulwt r11, r11, r9                          // ..................................................................*...........................................................................
        smlabt r9, r6, r12, r7                       // ...................................................................*..........................................................................
        smlabt r11, r11, r12, r7                     // ...................................................................*..........................................................................
        pkhtb r14, r11, r9, asr #16                  // ....................................................................*.........................................................................
        vmov r2, s21                                 // ....................................................................*.........................................................................
        vmov r11, s22                                // .....................................................................*........................................................................
        smulwb r10, r2, r4                           // .....................................................................*........................................................................
        smulwt r6, r2, r4                            // ......................................................................*.......................................................................
        smlabt r9, r10, r12, r7                      // ......................................................................*.......................................................................
        smlabt r1, r6, r12, r7                       // .......................................................................*......................................................................
        pkhtb r6, r1, r9, asr #16                    // .......................................................................*......................................................................
        str r6, [sp, #STACK_LOC_5]                   // .......................................................................s...................................................................... // @slothy:is_spill // @slothy:writes=stack_5
        smulwb r6, r11, r8                           // ........................................................................*.....................................................................
        smulwt r11, r11, r8                          // ........................................................................*.....................................................................
        smlabt r9, r6, r12, r7                       // .........................................................................*....................................................................
        smlabt r11, r11, r12, r7                     // .........................................................................*....................................................................
        pkhtb r6, r11, r9, asr #16                   // ..........................................................................*...................................................................
        str r6, [sp, #STACK_LOC_6]                   // ..........................................................................s................................................................... // @slothy:is_spill // @slothy:writes=stack_6
        vmov r10, s23                                // ..........................................................................*...................................................................
        ldr.w r2, [r10, #0]                          // ...........................................................................*..................................................................
        ldr.w r7, [r10, #distance/4]                 // ...........................................................................*..................................................................
        ldr.w r3, [r10, #2*distance/4]               // ............................................................................*.................................................................
        ldr.w r4, [r10, #3*distance/4]               // ............................................................................*.................................................................
        ldr.w r11, [r10, #distance]                  // .............................................................................*................................................................
        ldr.w r6, [r10, #5*distance/4]               // .............................................................................*................................................................
        ldr.w r9, [r10, #6*distance/4]               // ..............................................................................*...............................................................
        ldr.w r8, [r10, #7*distance/4]               // ..............................................................................*...............................................................
        movw r1, #26632                              // ...............................................................................*..............................................................
        vmov r0, s8                                  // ...............................................................................*..............................................................
        smulwb r5, r0, r11                           // ................................................................................*.............................................................
        smulwt r11, r0, r11                          // ................................................................................*.............................................................
        smlabt r5, r5, r12, r1                       // .................................................................................*............................................................
        smlabt r11, r11, r12, r1                     // .................................................................................*............................................................
        pkhtb r5, r11, r5, asr #16                   // ..................................................................................*...........................................................
        usub16 r10, r2, r5                           // ..................................................................................*...........................................................
        uadd16 r2, r2, r5                            // ...................................................................................*..........................................................
        smulwb r5, r0, r6                            // ...................................................................................*..........................................................
        smulwt r11, r0, r6                           // ....................................................................................*.........................................................
        smlabt r6, r5, r12, r1                       // ....................................................................................*.........................................................
        smlabt r11, r11, r12, r1                     // .....................................................................................*........................................................
        pkhtb r6, r11, r6, asr #16                   // .....................................................................................*........................................................
        usub16 r11, r7, r6                           // ......................................................................................*.......................................................
        uadd16 r5, r7, r6                            // ......................................................................................*.......................................................
        smulwb r6, r0, r9                            // .......................................................................................*......................................................
        smulwt r7, r0, r9                            // .......................................................................................*......................................................
        smlabt r9, r6, r12, r1                       // ........................................................................................*.....................................................
        smlabt r6, r7, r12, r1                       // ........................................................................................*.....................................................
        pkhtb r6, r6, r9, asr #16                    // .........................................................................................*....................................................
        usub16 r7, r3, r6                            // .........................................................................................*....................................................
        uadd16 r3, r3, r6                            // ..........................................................................................*...................................................
        smulwb r9, r0, r8                            // ..........................................................................................*...................................................
        smulwt r6, r0, r8                            // ...........................................................................................*..................................................
        smlabt r9, r9, r12, r1                       // ...........................................................................................*..................................................
        smlabt r6, r6, r12, r1                       // ............................................................................................*.................................................
        pkhtb r6, r6, r9, asr #16                    // ............................................................................................*.................................................
        usub16 r0, r4, r6                            // .............................................................................................*................................................
        uadd16 r8, r4, r6                            // .............................................................................................*................................................
        vmov r4, s9                                  // ..............................................................................................*...............................................
        vmov r9, s10                                 // ..............................................................................................*...............................................
        smulwb r6, r4, r3                            // ...............................................................................................*..............................................
        smulwt r3, r4, r3                            // ...............................................................................................*..............................................
        smlabt r6, r6, r12, r1                       // ................................................................................................*.............................................
        smlabt r3, r3, r12, r1                       // ................................................................................................*.............................................
        pkhtb r6, r3, r6, asr #16                    // .................................................................................................*............................................
        usub16 r3, r2, r6                            // .................................................................................................*............................................
        uadd16 r2, r2, r6                            // ..................................................................................................*...........................................
        smulwb r6, r4, r8                            // ..................................................................................................*...........................................
        smulwt r8, r4, r8                            // ...................................................................................................*..........................................
        smlabt r4, r6, r12, r1                       // ...................................................................................................*..........................................
        smlabt r6, r8, r12, r1                       // ....................................................................................................*.........................................
        pkhtb r6, r6, r4, asr #16                    // ....................................................................................................*.........................................
        usub16 r8, r5, r6                            // .....................................................................................................*........................................
        uadd16 r4, r5, r6                            // .....................................................................................................*........................................
        smulwb r5, r9, r7                            // ......................................................................................................*.......................................
        smulwt r6, r9, r7                            // ......................................................................................................*.......................................
        smlabt r7, r5, r12, r1                       // .......................................................................................................*......................................
        smlabt r6, r6, r12, r1                       // .......................................................................................................*......................................
        pkhtb r5, r6, r7, asr #16                    // ........................................................................................................*.....................................
        usub16 r7, r10, r5                           // ........................................................................................................*.....................................
        uadd16 r6, r10, r5                           // .........................................................................................................*....................................
        smulwb r5, r9, r0                            // .........................................................................................................*....................................
        smulwt r10, r9, r0                           // ..........................................................................................................*...................................
        smlabt r9, r5, r12, r1                       // ..........................................................................................................*...................................
        smlabt r10, r10, r12, r1                     // ...........................................................................................................*..................................
        pkhtb r10, r10, r9, asr #16                  // ...........................................................................................................*..................................
        usub16 r0, r11, r10                          // ............................................................................................................*.................................
        uadd16 r11, r11, r10                         // ............................................................................................................*.................................
        vmov r10, s11                                // .............................................................................................................*................................
        vmov r9, s12                                 // .............................................................................................................*................................
        smulwb r5, r10, r4                           // ..............................................................................................................*...............................
        smulwt r10, r10, r4                          // ..............................................................................................................*...............................
        smlabt r5, r5, r12, r1                       // ...............................................................................................................*..............................
        smlabt r10, r10, r12, r1                     // ...............................................................................................................*..............................
        pkhtb r5, r10, r5, asr #16                   // ................................................................................................................*.............................
        usub16 r10, r2, r5                           // ................................................................................................................*.............................
        uadd16 r2, r2, r5                            // .................................................................................................................*............................
        smulwb r4, r9, r8                            // .................................................................................................................*............................
        smulwt r5, r9, r8                            // ..................................................................................................................*...........................
        smlabt r9, r4, r12, r1                       // ..................................................................................................................*...........................
        smlabt r5, r5, r12, r1                       // ...................................................................................................................*..........................
        pkhtb r8, r5, r9, asr #16                    // ...................................................................................................................*..........................
        usub16 r4, r3, r8                            // ....................................................................................................................*.........................
        uadd16 r3, r3, r8                            // ....................................................................................................................*.........................
        vmov r8, s13                                 // .....................................................................................................................*........................
        vmov r5, s14                                 // .....................................................................................................................*........................
        smulwb r9, r8, r11                           // ......................................................................................................................*.......................
        smulwt r11, r8, r11                          // ......................................................................................................................*.......................
        smlabt r9, r9, r12, r1                       // .......................................................................................................................*......................
        smlabt r8, r11, r12, r1                      // .......................................................................................................................*......................
        pkhtb r8, r8, r9, asr #16                    // ........................................................................................................................*.....................
        usub16 r9, r6, r8                            // ........................................................................................................................*.....................
        uadd16 r8, r6, r8                            // .........................................................................................................................*....................
        smulwb r11, r5, r0                           // .........................................................................................................................*....................
        smulwt r6, r5, r0                            // ..........................................................................................................................*...................
        smlabt r11, r11, r12, r1                     // ..........................................................................................................................*...................
        smlabt r6, r6, r12, r1                       // ...........................................................................................................................*..................
        pkhtb r11, r6, r11, asr #16                  // ...........................................................................................................................*..................
        ldr r6, [sp, #STACK_LOC_1]                   // ...........................................................................................................................r.................. // @slothy:is_restore // @slothy:reads=stack_1
        usub16 r5, r7, r11                           // ............................................................................................................................*.................
        uadd16 r11, r7, r11                          // ............................................................................................................................*.................
        vmov r0, s23                                 // .............................................................................................................................*................
        uadd16 r7, r10, r6                           // .............................................................................................................................*................
        usub16 r1, r10, r6                           // ..............................................................................................................................*...............
        ldr r6, [sp, #STACK_LOC_3]                   // ..............................................................................................................................r............... // @slothy:is_restore // @slothy:reads=stack_3
        str.w r7, [r0, #1*distance/4]                // ..............................................................................................................................*...............
        str.w r1, [r0, #1*distance/4+offset]         // ...............................................................................................................................*..............
        uadd16 r10, r4, r6                           // ...............................................................................................................................*..............
        usub16 r7, r4, r6                            // ................................................................................................................................*.............
        ldr r6, [sp, #STACK_LOC_6]                   // ................................................................................................................................r............. // @slothy:is_restore // @slothy:reads=stack_6
        str.w r10, [r0, #3*distance/4]               // ................................................................................................................................*.............
        str.w r7, [r0, #3*distance/4+offset]         // .................................................................................................................................*............
        uadd16 r10, r9, r14                          // .................................................................................................................................*............
        usub16 r9, r9, r14                           // ..................................................................................................................................*...........
        str.w r10, [r0, #5*distance/4]               // ..................................................................................................................................*...........
        str.w r9, [r0, #5*distance/4+offset]         // ...................................................................................................................................*..........
        uadd16 r10, r5, r6                           // ...................................................................................................................................*..........
        usub16 r9, r5, r6                            // ....................................................................................................................................*.........
        ldr r6, [sp, #STACK_LOC_2]                   // ....................................................................................................................................r......... // @slothy:is_restore // @slothy:reads=stack_2
        str.w r10, [r0, #7*distance/4]               // ....................................................................................................................................*.........
        str.w r9, [r0, #7*distance/4+offset]         // .....................................................................................................................................*........
        uadd16 r10, r3, r6                           // .....................................................................................................................................*........
        usub16 r9, r3, r6                            // ......................................................................................................................................*.......
        ldr r6, [sp, #STACK_LOC_4]                   // ......................................................................................................................................r....... // @slothy:is_restore // @slothy:reads=stack_4
        str.w r10, [r0, #2*distance/4]               // ......................................................................................................................................*.......
        str.w r9, [r0, #2*distance/4+offset]         // .......................................................................................................................................*......
        uadd16 r10, r8, r6                           // .......................................................................................................................................*......
        usub16 r9, r8, r6                            // ........................................................................................................................................*.....
        ldr r6, [sp, #STACK_LOC_5]                   // ........................................................................................................................................r..... // @slothy:is_restore // @slothy:reads=stack_5
        str.w r10, [r0, #4*distance/4]               // ........................................................................................................................................*.....
        str.w r9, [r0, #4*distance/4+offset]         // .........................................................................................................................................*....
        uadd16 r10, r11, r6                          // .........................................................................................................................................*....
        usub16 r9, r11, r6                           // ..........................................................................................................................................*...
        str.w r10, [r0, #6*distance/4]               // ..........................................................................................................................................*...
        ldr r10, [sp, #STACK_LOC_0]                  // ..........................................................................................................................................r... // @slothy:is_restore // @slothy:reads=stack_0
        str.w r9, [r0, #6*distance/4+offset]         // ...........................................................................................................................................*..
        uadd16 r8, r2, r10                           // ...........................................................................................................................................*..
        usub16 r11, r2, r10                          // ............................................................................................................................................*.
        str.w r11, [r0, #offset]                     // ............................................................................................................................................*.
        str.w r8, [r0], #4                           // .............................................................................................................................................*
        vmov r14, s24                                // .............................................................................................................................................*

                                                            // ------------------------------------------------------------- cycle (expected) -------------------------------------------------------------->
                                                            // 0                        25                       50                       75                       100                      125
                                                            // |------------------------|------------------------|------------------------|------------------------|------------------------|----------------
        // vmov s23, r0                                     // *.............................................................................................................................................
        // ldr.w R<poly1>, [r0, #offset]                    // *.............................................................................................................................................
        // ldr.w R<poly3>, [r0, #distance/4+offset]         // .*............................................................................................................................................
        // ldr.w R<poly5>, [r0, #2*distance/4+offset]       // .*............................................................................................................................................
        // ldr.w R<poly7>, [r0, #3*distance/4+offset]       // ..*...........................................................................................................................................
        // ldr.w R<poly9>, [r0, #distance+offset]           // ..*...........................................................................................................................................
        // ldr.w R<poly11>, [r0, #5*distance/4+offset]      // ...*..........................................................................................................................................
        // ldr.w R<poly13>, [r0, #6*distance/4+offset]      // ...*..........................................................................................................................................
        // ldr.w R<poly15>, [r0, #7*distance/4+offset]      // ....*.........................................................................................................................................
        // movw r0, #26632                                  // ....*.........................................................................................................................................
        // vmov r10, s8                                     // .....*........................................................................................................................................
        // smulwb r14, r10, R<poly9>                        // .....*........................................................................................................................................
        // smulwt R<poly9>, r10, R<poly9>                   // ......*.......................................................................................................................................
        // smlabt r14, r14, r12, r0                         // ......*.......................................................................................................................................
        // smlabt R<poly9>, R<poly9>, r12, r0               // .......*......................................................................................................................................
        // pkhtb r14, R<poly9>, r14, asr #16                // .......*......................................................................................................................................
        // usub16 R<poly9>, R<poly1>, r14                   // ........*.....................................................................................................................................
        // uadd16 R<poly1>, R<poly1>, r14                   // ........*.....................................................................................................................................
        // smulwb r14, r10, R<poly11>                       // .........*....................................................................................................................................
        // smulwt R<poly11>, r10, R<poly11>                 // .........*....................................................................................................................................
        // smlabt r14, r14, r12, r0                         // ..........*...................................................................................................................................
        // smlabt R<poly11>, R<poly11>, r12, r0             // ..........*...................................................................................................................................
        // pkhtb r14, R<poly11>, r14, asr #16               // ...........*..................................................................................................................................
        // usub16 R<poly11>, R<poly3>, r14                  // ...........*..................................................................................................................................
        // uadd16 R<poly3>, R<poly3>, r14                   // ............*.................................................................................................................................
        // smulwb r14, r10, R<poly13>                       // ............*.................................................................................................................................
        // smulwt R<poly13>, r10, R<poly13>                 // .............*................................................................................................................................
        // smlabt r14, r14, r12, r0                         // .............*................................................................................................................................
        // smlabt R<poly13>, R<poly13>, r12, r0             // ..............*...............................................................................................................................
        // pkhtb r14, R<poly13>, r14, asr #16               // ..............*...............................................................................................................................
        // usub16 R<poly13>, R<poly5>, r14                  // ...............*..............................................................................................................................
        // uadd16 R<poly5>, R<poly5>, r14                   // ...............*..............................................................................................................................
        // smulwb r14, r10, R<poly15>                       // ................*.............................................................................................................................
        // smulwt R<poly15>, r10, R<poly15>                 // ................*.............................................................................................................................
        // smlabt r14, r14, r12, r0                         // .................*............................................................................................................................
        // smlabt R<poly15>, R<poly15>, r12, r0             // .................*............................................................................................................................
        // pkhtb r14, R<poly15>, r14, asr #16               // ..................*...........................................................................................................................
        // usub16 R<poly15>, R<poly7>, r14                  // ..................*...........................................................................................................................
        // uadd16 R<poly7>, R<poly7>, r14                   // ...................*..........................................................................................................................
        // vmov r10, s9                                     // ...................*..........................................................................................................................
        // vmov r11, s10                                    // ....................*.........................................................................................................................
        // smulwb r14, r10, R<poly5>                        // ....................*.........................................................................................................................
        // smulwt R<poly5>, r10, R<poly5>                   // .....................*........................................................................................................................
        // smlabt r14, r14, r12, r0                         // .....................*........................................................................................................................
        // smlabt R<poly5>, R<poly5>, r12, r0               // ......................*.......................................................................................................................
        // pkhtb r14, R<poly5>, r14, asr #16                // ......................*.......................................................................................................................
        // usub16 R<poly5>, R<poly1>, r14                   // .......................*......................................................................................................................
        // uadd16 R<poly1>, R<poly1>, r14                   // .......................*......................................................................................................................
        // smulwb r14, r10, R<poly7>                        // ........................*.....................................................................................................................
        // smulwt R<poly7>, r10, R<poly7>                   // ........................*.....................................................................................................................
        // smlabt r14, r14, r12, r0                         // .........................*....................................................................................................................
        // smlabt R<poly7>, R<poly7>, r12, r0               // .........................*....................................................................................................................
        // pkhtb r14, R<poly7>, r14, asr #16                // ..........................*...................................................................................................................
        // usub16 R<poly7>, R<poly3>, r14                   // ..........................*...................................................................................................................
        // uadd16 R<poly3>, R<poly3>, r14                   // ...........................*..................................................................................................................
        // smulwb r14, r11, R<poly13>                       // ...........................*..................................................................................................................
        // smulwt R<poly13>, r11, R<poly13>                 // ............................*.................................................................................................................
        // smlabt r14, r14, r12, r0                         // ............................*.................................................................................................................
        // smlabt R<poly13>, R<poly13>, r12, r0             // .............................*................................................................................................................
        // pkhtb r14, R<poly13>, r14, asr #16               // .............................*................................................................................................................
        // usub16 R<poly13>, R<poly9>, r14                  // ..............................*...............................................................................................................
        // uadd16 R<poly9>, R<poly9>, r14                   // ..............................*...............................................................................................................
        // smulwb r14, r11, R<poly15>                       // ...............................*..............................................................................................................
        // smulwt R<poly15>, r11, R<poly15>                 // ...............................*..............................................................................................................
        // smlabt r14, r14, r12, r0                         // ................................*.............................................................................................................
        // smlabt R<poly15>, R<poly15>, r12, r0             // ................................*.............................................................................................................
        // pkhtb r14, R<poly15>, r14, asr #16               // .................................*............................................................................................................
        // usub16 R<poly15>, R<poly11>, r14                 // .................................*............................................................................................................
        // uadd16 R<poly11>, R<poly11>, r14                 // ..................................*...........................................................................................................
        // vmov r10, s11                                    // ..................................*...........................................................................................................
        // vmov r11, s12                                    // ...................................*..........................................................................................................
        // smulwb r14, r10, R<poly3>                        // ...................................*..........................................................................................................
        // smulwt R<poly3>, r10, R<poly3>                   // ....................................*.........................................................................................................
        // smlabt r14, r14, r12, r0                         // ....................................*.........................................................................................................
        // smlabt R<poly3>, R<poly3>, r12, r0               // .....................................*........................................................................................................
        // pkhtb r14, R<poly3>, r14, asr #16                // .....................................*........................................................................................................
        // usub16 R<poly3>, R<poly1>, r14                   // ......................................*.......................................................................................................
        // uadd16 R<poly1>, R<poly1>, r14                   // ......................................*.......................................................................................................
        // smulwb r14, r11, R<poly7>                        // .......................................*......................................................................................................
        // smulwt R<poly7>, r11, R<poly7>                   // .......................................*......................................................................................................
        // smlabt r14, r14, r12, r0                         // ........................................*.....................................................................................................
        // smlabt R<poly7>, R<poly7>, r12, r0               // ........................................*.....................................................................................................
        // pkhtb r14, R<poly7>, r14, asr #16                // .........................................*....................................................................................................
        // usub16 R<poly7>, R<poly5>, r14                   // .........................................*....................................................................................................
        // uadd16 R<poly5>, R<poly5>, r14                   // ..........................................*...................................................................................................
        // vmov r10, s13                                    // ..........................................*...................................................................................................
        // vmov r11, s14                                    // ...........................................*..................................................................................................
        // smulwb r14, r10, R<poly11>                       // ...........................................*..................................................................................................
        // smulwt R<poly11>, r10, R<poly11>                 // ............................................*.................................................................................................
        // smlabt r14, r14, r12, r0                         // ............................................*.................................................................................................
        // smlabt R<poly11>, R<poly11>, r12, r0             // .............................................*................................................................................................
        // pkhtb r14, R<poly11>, r14, asr #16               // .............................................*................................................................................................
        // usub16 R<poly11>, R<poly9>, r14                  // ..............................................*...............................................................................................
        // uadd16 R<poly9>, R<poly9>, r14                   // ..............................................*...............................................................................................
        // smulwb r14, r11, R<poly15>                       // ...............................................*..............................................................................................
        // smulwt R<poly15>, r11, R<poly15>                 // ...............................................*..............................................................................................
        // smlabt r14, r14, r12, r0                         // ................................................*.............................................................................................
        // smlabt R<poly15>, R<poly15>, r12, r0             // ................................................*.............................................................................................
        // pkhtb r14, R<poly15>, r14, asr #16               // .................................................*............................................................................................
        // usub16 R<poly15>, R<poly13>, r14                 // .................................................*............................................................................................
        // uadd16 R<poly13>, R<poly13>, r14                 // ..................................................*...........................................................................................
        // vmov r10, s15                                    // ..................................................*...........................................................................................
        // vmov r11, s16                                    // ...................................................*..........................................................................................
        // smulwb r14, r10, R<poly1>                        // ...................................................*..........................................................................................
        // smulwt R<poly1>,   r10, R<poly1>                 // ....................................................*.........................................................................................
        // smlabt r14, r14, r12, r0                         // ....................................................*.........................................................................................
        // smlabt R<poly1>, R<poly1>, r12, r0               // .....................................................*........................................................................................
        // pkhtb R<poly1>, R<poly1>, r14, asr #16           // .....................................................*........................................................................................
        // smulwb r14, r11, R<poly3>                        // ......................................................*.......................................................................................
        // smulwt R<poly3>,   r11, R<poly3>                 // ......................................................*.......................................................................................
        // smlabt r14, r14, r12, r0                         // .......................................................*......................................................................................
        // smlabt R<poly3>, R<poly3>, r12, r0               // .......................................................*......................................................................................
        // pkhtb R<poly3>, R<poly3>, r14, asr #16           // ........................................................*.....................................................................................
        // vmov r10, s17                                    // ........................................................*.....................................................................................
        // vmov r11, s18                                    // .........................................................*....................................................................................
        // smulwb r14, r10, R<poly5>                        // .........................................................*....................................................................................
        // smulwt R<poly5>,   r10, R<poly5>                 // ..........................................................*...................................................................................
        // smlabt r14, r14, r12, r0                         // ..........................................................*...................................................................................
        // smlabt R<poly5>, R<poly5>, r12, r0               // ...........................................................*..................................................................................
        // pkhtb R<poly5>, R<poly5>, r14, asr #16           // ...........................................................*..................................................................................
        // smulwb r14, r11, R<poly7>                        // ............................................................*.................................................................................
        // smulwt R<poly7>,   r11, R<poly7>                 // ............................................................*.................................................................................
        // smlabt r14, r14, r12, r0                         // .............................................................*................................................................................
        // smlabt R<poly7>, R<poly7>, r12, r0               // .............................................................*................................................................................
        // pkhtb R<poly7>, R<poly7>, r14, asr #16           // ..............................................................*...............................................................................
        // vmov r10, s19                                    // ..............................................................*...............................................................................
        // vmov r11, s20                                    // ...............................................................*..............................................................................
        // smulwb r14, r10, R<poly9>                        // ...............................................................*..............................................................................
        // smulwt R<poly9>,   r10, R<poly9>                 // ................................................................*.............................................................................
        // smlabt r14, r14, r12, r0                         // ................................................................*.............................................................................
        // smlabt R<poly9>, R<poly9>, r12, r0               // .................................................................*............................................................................
        // pkhtb R<poly9>, R<poly9>, r14, asr #16           // .................................................................*............................................................................
        // smulwb r14, r11, R<poly11>                       // ..................................................................*...........................................................................
        // smulwt R<poly11>,   r11, R<poly11>               // ..................................................................*...........................................................................
        // smlabt r14, r14, r12, r0                         // ...................................................................*..........................................................................
        // smlabt R<poly11>, R<poly11>, r12, r0             // ...................................................................*..........................................................................
        // pkhtb R<poly11>, R<poly11>, r14, asr #16         // ....................................................................*.........................................................................
        // vmov r10, s21                                    // ....................................................................*.........................................................................
        // vmov r11, s22                                    // .....................................................................*........................................................................
        // smulwb r14, r10, R<poly13>                       // .....................................................................*........................................................................
        // smulwt R<poly13>,   r10, R<poly13>               // ......................................................................*.......................................................................
        // smlabt r14, r14, r12, r0                         // ......................................................................*.......................................................................
        // smlabt R<poly13>, R<poly13>, r12, r0             // .......................................................................*......................................................................
        // pkhtb R<poly13>, R<poly13>, r14, asr #16         // .......................................................................*......................................................................
        // smulwb r14, r11, R<poly15>                       // ........................................................................*.....................................................................
        // smulwt R<poly15>,   r11, R<poly15>               // ........................................................................*.....................................................................
        // smlabt r14, r14, r12, r0                         // .........................................................................*....................................................................
        // smlabt R<poly15>, R<poly15>, r12, r0             // .........................................................................*....................................................................
        // pkhtb R<poly15>, R<poly15>, r14, asr #16         // ..........................................................................*...................................................................
        // vmov r0, s23                                     // ..........................................................................*...................................................................
        // ldr.w R<poly0>, [r0, #0]                         // ...........................................................................*..................................................................
        // ldr.w R<poly2>, [r0, #distance/4]                // ...........................................................................*..................................................................
        // ldr.w R<poly4>, [r0, #2*distance/4]              // ............................................................................*.................................................................
        // ldr.w R<poly6>, [r0, #3*distance/4]              // ............................................................................*.................................................................
        // ldr.w R<poly8>, [r0, #distance]                  // .............................................................................*................................................................
        // ldr.w R<poly10>, [r0, #5*distance/4]             // .............................................................................*................................................................
        // ldr.w R<poly12>, [r0, #6*distance/4]             // ..............................................................................*...............................................................
        // ldr.w R<poly14>, [r0, #7*distance/4]             // ..............................................................................*...............................................................
        // movw r0, #26632                                  // ...............................................................................*..............................................................
        // vmov r10, s8                                     // ...............................................................................*..............................................................
        // smulwb r14, r10, R<poly8>                        // ................................................................................*.............................................................
        // smulwt R<poly8>, r10, R<poly8>                   // ................................................................................*.............................................................
        // smlabt r14, r14, r12, r0                         // .................................................................................*............................................................
        // smlabt R<poly8>, R<poly8>, r12, r0               // .................................................................................*............................................................
        // pkhtb r14, R<poly8>, r14, asr #16                // ..................................................................................*...........................................................
        // usub16 R<poly8>, R<poly0>, r14                   // ..................................................................................*...........................................................
        // uadd16 R<poly0>, R<poly0>, r14                   // ...................................................................................*..........................................................
        // smulwb r14, r10, R<poly10>                       // ...................................................................................*..........................................................
        // smulwt R<poly10>, r10, R<poly10>                 // ....................................................................................*.........................................................
        // smlabt r14, r14, r12, r0                         // ....................................................................................*.........................................................
        // smlabt R<poly10>, R<poly10>, r12, r0             // .....................................................................................*........................................................
        // pkhtb r14, R<poly10>, r14, asr #16               // .....................................................................................*........................................................
        // usub16 R<poly10>, R<poly2>, r14                  // ......................................................................................*.......................................................
        // uadd16 R<poly2>, R<poly2>, r14                   // ......................................................................................*.......................................................
        // smulwb r14, r10, R<poly12>                       // .......................................................................................*......................................................
        // smulwt R<poly12>, r10, R<poly12>                 // .......................................................................................*......................................................
        // smlabt r14, r14, r12, r0                         // ........................................................................................*.....................................................
        // smlabt R<poly12>, R<poly12>, r12, r0             // ........................................................................................*.....................................................
        // pkhtb r14, R<poly12>, r14, asr #16               // .........................................................................................*....................................................
        // usub16 R<poly12>, R<poly4>, r14                  // .........................................................................................*....................................................
        // uadd16 R<poly4>, R<poly4>, r14                   // ..........................................................................................*...................................................
        // smulwb r14, r10, R<poly14>                       // ..........................................................................................*...................................................
        // smulwt R<poly14>, r10, R<poly14>                 // ...........................................................................................*..................................................
        // smlabt r14, r14, r12, r0                         // ...........................................................................................*..................................................
        // smlabt R<poly14>, R<poly14>, r12, r0             // ............................................................................................*.................................................
        // pkhtb r14, R<poly14>, r14, asr #16               // ............................................................................................*.................................................
        // usub16 R<poly14>, R<poly6>, r14                  // .............................................................................................*................................................
        // uadd16 R<poly6>, R<poly6>, r14                   // .............................................................................................*................................................
        // vmov r10, s9                                     // ..............................................................................................*...............................................
        // vmov r11, s10                                    // ..............................................................................................*...............................................
        // smulwb r14, r10, R<poly4>                        // ...............................................................................................*..............................................
        // smulwt R<poly4>, r10, R<poly4>                   // ...............................................................................................*..............................................
        // smlabt r14, r14, r12, r0                         // ................................................................................................*.............................................
        // smlabt R<poly4>, R<poly4>, r12, r0               // ................................................................................................*.............................................
        // pkhtb r14, R<poly4>, r14, asr #16                // .................................................................................................*............................................
        // usub16 R<poly4>, R<poly0>, r14                   // .................................................................................................*............................................
        // uadd16 R<poly0>, R<poly0>, r14                   // ..................................................................................................*...........................................
        // smulwb r14, r10, R<poly6>                        // ..................................................................................................*...........................................
        // smulwt R<poly6>, r10, R<poly6>                   // ...................................................................................................*..........................................
        // smlabt r14, r14, r12, r0                         // ...................................................................................................*..........................................
        // smlabt R<poly6>, R<poly6>, r12, r0               // ....................................................................................................*.........................................
        // pkhtb r14, R<poly6>, r14, asr #16                // ....................................................................................................*.........................................
        // usub16 R<poly6>, R<poly2>, r14                   // .....................................................................................................*........................................
        // uadd16 R<poly2>, R<poly2>, r14                   // .....................................................................................................*........................................
        // smulwb r14, r11, R<poly12>                       // ......................................................................................................*.......................................
        // smulwt R<poly12>, r11, R<poly12>                 // ......................................................................................................*.......................................
        // smlabt r14, r14, r12, r0                         // .......................................................................................................*......................................
        // smlabt R<poly12>, R<poly12>, r12, r0             // .......................................................................................................*......................................
        // pkhtb r14, R<poly12>, r14, asr #16               // ........................................................................................................*.....................................
        // usub16 R<poly12>, R<poly8>, r14                  // ........................................................................................................*.....................................
        // uadd16 R<poly8>, R<poly8>, r14                   // .........................................................................................................*....................................
        // smulwb r14, r11, R<poly14>                       // .........................................................................................................*....................................
        // smulwt R<poly14>, r11, R<poly14>                 // ..........................................................................................................*...................................
        // smlabt r14, r14, r12, r0                         // ..........................................................................................................*...................................
        // smlabt R<poly14>, R<poly14>, r12, r0             // ...........................................................................................................*..................................
        // pkhtb r14, R<poly14>, r14, asr #16               // ...........................................................................................................*..................................
        // usub16 R<poly14>, R<poly10>, r14                 // ............................................................................................................*.................................
        // uadd16 R<poly10>, R<poly10>, r14                 // ............................................................................................................*.................................
        // vmov r10, s11                                    // .............................................................................................................*................................
        // vmov r11, s12                                    // .............................................................................................................*................................
        // smulwb r14, r10, R<poly2>                        // ..............................................................................................................*...............................
        // smulwt R<poly2>, r10, R<poly2>                   // ..............................................................................................................*...............................
        // smlabt r14, r14, r12, r0                         // ...............................................................................................................*..............................
        // smlabt R<poly2>, R<poly2>, r12, r0               // ...............................................................................................................*..............................
        // pkhtb r14, R<poly2>, r14, asr #16                // ................................................................................................................*.............................
        // usub16 R<poly2>, R<poly0>, r14                   // ................................................................................................................*.............................
        // uadd16 R<poly0>, R<poly0>, r14                   // .................................................................................................................*............................
        // smulwb r14, r11, R<poly6>                        // .................................................................................................................*............................
        // smulwt R<poly6>, r11, R<poly6>                   // ..................................................................................................................*...........................
        // smlabt r14, r14, r12, r0                         // ..................................................................................................................*...........................
        // smlabt R<poly6>, R<poly6>, r12, r0               // ...................................................................................................................*..........................
        // pkhtb r14, R<poly6>, r14, asr #16                // ...................................................................................................................*..........................
        // usub16 R<poly6>, R<poly4>, r14                   // ....................................................................................................................*.........................
        // uadd16 R<poly4>, R<poly4>, r14                   // ....................................................................................................................*.........................
        // vmov r10, s13                                    // .....................................................................................................................*........................
        // vmov r11, s14                                    // .....................................................................................................................*........................
        // smulwb r14, r10, R<poly10>                       // ......................................................................................................................*.......................
        // smulwt R<poly10>, r10, R<poly10>                 // ......................................................................................................................*.......................
        // smlabt r14, r14, r12, r0                         // .......................................................................................................................*......................
        // smlabt R<poly10>, R<poly10>, r12, r0             // .......................................................................................................................*......................
        // pkhtb r14, R<poly10>, r14, asr #16               // ........................................................................................................................*.....................
        // usub16 R<poly10>, R<poly8>, r14                  // ........................................................................................................................*.....................
        // uadd16 R<poly8>, R<poly8>, r14                   // .........................................................................................................................*....................
        // smulwb r14, r11, R<poly14>                       // .........................................................................................................................*....................
        // smulwt R<poly14>, r11, R<poly14>                 // ..........................................................................................................................*...................
        // smlabt r14, r14, r12, r0                         // ..........................................................................................................................*...................
        // smlabt R<poly14>, R<poly14>, r12, r0             // ...........................................................................................................................*..................
        // pkhtb r14, R<poly14>, r14, asr #16               // ...........................................................................................................................*..................
        // usub16 R<poly14>, R<poly12>, r14                 // ............................................................................................................................*.................
        // uadd16 R<poly12>, R<poly12>, r14                 // ............................................................................................................................*.................
        // vmov r0, s23                                     // .............................................................................................................................*................
        // uadd16 r14, R<poly2>, R<poly3>                   // .............................................................................................................................*................
        // usub16 R<poly2>, R<poly2>, R<poly3>              // ..............................................................................................................................*...............
        // str.w r14, [r0, #1*distance/4]                   // ..............................................................................................................................*...............
        // str.w R<poly2>, [r0, #1*distance/4+offset]       // ...............................................................................................................................*..............
        // uadd16 r14, R<poly6>, R<poly7>                   // ...............................................................................................................................*..............
        // usub16 R<poly6>, R<poly6>, R<poly7>              // ................................................................................................................................*.............
        // str.w r14, [r0, #3*distance/4]                   // ................................................................................................................................*.............
        // str.w R<poly6>, [r0, #3*distance/4+offset]       // .................................................................................................................................*............
        // uadd16 r14, R<poly10>, R<poly11>                 // .................................................................................................................................*............
        // usub16 R<poly10>, R<poly10>, R<poly11>           // ..................................................................................................................................*...........
        // str.w r14, [r0, #5*distance/4]                   // ..................................................................................................................................*...........
        // str.w R<poly10>, [r0, #5*distance/4+offset]      // ...................................................................................................................................*..........
        // uadd16 r14, R<poly14>, R<poly15>                 // ...................................................................................................................................*..........
        // usub16 R<poly14>, R<poly14>, R<poly15>           // ....................................................................................................................................*.........
        // str.w r14, [r0, #7*distance/4]                   // ....................................................................................................................................*.........
        // str.w R<poly14>, [r0, #7*distance/4+offset]      // .....................................................................................................................................*........
        // uadd16 r14, R<poly4>, R<poly5>                   // .....................................................................................................................................*........
        // usub16 r10, R<poly4>, R<poly5>                   // ......................................................................................................................................*.......
        // str.w r14, [r0, #2*distance/4]                   // ......................................................................................................................................*.......
        // str.w r10, [r0, #2*distance/4+offset]            // .......................................................................................................................................*......
        // uadd16 r14, R<poly8>, R<poly9>                   // .......................................................................................................................................*......
        // usub16 r10, R<poly8>, R<poly9>                   // ........................................................................................................................................*.....
        // str.w r14, [r0, #4*distance/4]                   // ........................................................................................................................................*.....
        // str.w r10, [r0, #4*distance/4+offset]            // .........................................................................................................................................*....
        // uadd16 r14, R<poly12>, R<poly13>                 // .........................................................................................................................................*....
        // usub16 r10, R<poly12>, R<poly13>                 // ..........................................................................................................................................*...
        // str.w r14, [r0, #6*distance/4]                   // ..........................................................................................................................................*...
        // str.w r10, [r0, #6*distance/4+offset]            // ...........................................................................................................................................*..
        // uadd16 r14, R<poly0>, R<poly1>                   // ...........................................................................................................................................*..
        // usub16 r10, R<poly0>, R<poly1>                   // ............................................................................................................................................*.
        // str.w r10, [r0, #offset]                         // ............................................................................................................................................*.
        // str.w r14, [r0], #4                              // .............................................................................................................................................*
        // vmov r14, s24                                    // .............................................................................................................................................*

        layer1234_end:

 cmp.w poly, tmp
 bne.w 1b


 poly0        .req r2
 poly1        .req r3
 poly2        .req r4
 poly3        .req r5
 poly4        .req r6
 poly5        .req r7
 poly6        .req r8
 poly7        .req r9

 sub.w poly, #8*strincr
 vmov twiddle_ptr, s25

 ### LAYER 3+2+1

 .equ distance, distance/16
 .equ strincr, 32

 add.w tmp, poly, #strincr*16
 vmov s13, tmp
 2:
 layer567_start:
  vmov s23, poly
  load poly, poly0, poly1, poly2, poly3, #0, #distance/4, #2*distance/4, #3*distance/4
  load poly, poly4, poly5, poly6, poly7, #distance, #5*distance/4, #6*distance/4, #7*distance/4

  movw qa, #26632
  _3_layer_double_CT_16_plant poly0, poly1, poly2, poly3, poly4, poly5, poly6, poly7, twiddle1, twiddle2, twiddle_ptr, q, qa, tmp

  vmov poly, s23
  store poly, poly4, poly5, poly6, poly7, #distance, #5*distance/4, #6*distance/4, #7*distance/4
  str.w poly1, [poly, #distance/4]
  str.w poly2, [poly, #2*distance/4]
  str.w poly3, [poly, #3*distance/4]
  str.w poly0, [poly], #strincr

 vmov tmp, s13
 layer567_end:

 cmp.w poly, tmp
 bne.w 2b

 add.w sp, sp, STACK_SIZE

 vpop.w {s16-s25}
 pop {r4-r11, pc}

.size ntt_fast_symbolic_opt_m7, .-ntt_fast_symbolic_opt_m7