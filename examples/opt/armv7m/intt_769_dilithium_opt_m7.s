/**
 * Copyright (c) 2023 Junhao Huang (jhhuang_nuaa@126.com)
 *
 * Licensed under the Apache License, Version 2.0(the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http:// www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
.syntax unified
.cpu cortex-m4
.thumb

// general macros
.macro load a, a0, a1, a2, a3, mem0, mem1, mem2, mem3
  ldr.w \a0, [\a, \mem0]
  ldr.w \a1, [\a, \mem1]
  ldr.w \a2, [\a, \mem2]
  ldr.w \a3, [\a, \mem3]
.endm

.macro store a, a0, a1, a2, a3, mem0, mem1, mem2, mem3
  str.w \a0, [\a, \mem0]
  str.w \a1, [\a, \mem1]
  str.w \a2, [\a, \mem2]
  str.w \a3, [\a, \mem3]
.endm

.macro mul_twiddle_plant a, twiddle, tmp, q, qa
 smulwb \tmp, \twiddle, \a
 smulwt \a,   \twiddle, \a
 smlabt \tmp, \tmp, \q, \qa
 smlabt \a, \a, \q, \qa
 pkhtb \a, \a, \tmp, asr #16
.endm

.macro doublebutterfly_plant a0, a1, twiddle, tmp, q, qa
 smulwb \tmp, \twiddle, \a1
 smulwt \a1, \twiddle, \a1
 smlabt \tmp, \tmp, \q, \qa
 smlabt \a1, \a1, \q, \qa
 pkhtb \tmp, \a1, \tmp, asr #16
 usub16 \a1, \a0, \tmp
 uadd16 \a0, \a0, \tmp
.endm

.macro two_doublebutterfly_plant a0, a1, a2, a3, twiddle0, twiddle1, tmp, q, qa
 doublebutterfly_plant \a0, \a1, \twiddle0, \tmp, \q, \qa
 doublebutterfly_plant \a2, \a3, \twiddle1, \tmp, \q, \qa
.endm

// ########
// ########
// # INTT #
// ########
// ########

// input: 0.5/1q
.macro _3_layer_double_inv_CT_16_plant_light c0, c1, c2, c3, c4, c5, c6, c7, xi2, xi4, xi5, xi6, twiddle1, tmp2, q, qa, tmp

 // layer 1
 sadd16.w \tmp, \c0, \c1 // c0, c1
 ssub16.w \c1, \c0, \c1
 sadd16.w \tmp2, \c2, \c3 // c2, c3
 ssub16.w \c3, \c2, \c3
 // tmp, c1, tmp2, c3: 1q maximum
 sadd16.w \c0, \c4, \c5 // c4, c5
 ssub16.w \c5, \c4, \c5
 sadd16.w \c2, \c6, \c7 // c6, c7
 ssub16.w \c7, \c6, \c7
 // c4, c6 are free at this point
 // c0,c5,c2,c7 1q maximum

 // layer 2
 sadd16.w \c6, \tmp, \tmp2 // c0, c2
 ssub16.w \tmp2, \tmp, \tmp2
 sadd16.w \c4, \c0, \c2 // c4, c6
 ssub16.w \c2, \c0, \c2
 // c6, tmp2, c4, c2: 2q maximum

 vmov.w \twiddle1, \xi2
 doublebutterfly_plant \c1, \c3, \twiddle1, \tmp, \q, \qa
 doublebutterfly_plant \c5, \c7, \twiddle1, \tmp, \q, \qa
 // c1, c3, c7, c5: 1.5q maximum;

 // tmp and c0 are free at this point
 // layer 3
 sadd16.w \c0, \c6, \c4 // c0, c4
 ssub16.w \c4, \c6, \c4
 // c0, c4: 4q
 // c6 are free at this point
 vmov.w \twiddle1, \xi4
 doublebutterfly_plant \c1, \c5, \twiddle1, \tmp, \q, \qa
 // c1, c5: 2q maximum

 vmov.w \twiddle1, \xi5
 // this block is one doublebutterfly
 smulwb \tmp, \twiddle1, \c2  // c2, c6
 smulwt \c2,  \twiddle1, \c2
 smlabt \tmp, \tmp, \q, \qa
 smlabt \c2, \c2, \q, \qa
 pkhtb \tmp, \c2, \tmp, asr #16
 ssub16.w \c6, \tmp2, \tmp
 sadd16.w \c2, \tmp2, \tmp
 // c6, c2: 4.5q
 vmov.w \twiddle1, \xi6
 doublebutterfly_plant \c3, \c7, \twiddle1, \tmp, \q, \qa
 // c3, c7: 2.5q maximum
.endm
.macro _3_layer_double_inv_CT_16_plant c0, c1, c2, c3, c4, c5, c6, c7, twiddle1, twiddle2, twiddle_ptr, q, qa, tmp
 // layer 3
 ldr.w \twiddle1, [\twiddle_ptr], #4
 two_doublebutterfly_plant \c0, \c1, \c2, \c3, \twiddle1, \twiddle1, \tmp, \q, \qa
 two_doublebutterfly_plant \c4, \c5, \c6, \c7, \twiddle1, \twiddle1, \tmp, \q, \qa

 // layer 2
 ldrd \twiddle1, \twiddle2, [\twiddle_ptr], #8
 two_doublebutterfly_plant \c0, \c2, \c1, \c3, \twiddle1, \twiddle2, \tmp, \q, \qa

 two_doublebutterfly_plant \c4, \c6, \c5, \c7, \twiddle1, \twiddle2, \tmp, \q, \qa

 // layer 1
 ldrd \twiddle1, \twiddle2, [\twiddle_ptr], #8
 two_doublebutterfly_plant \c0, \c4, \c1, \c5, \twiddle1, \twiddle2, \tmp, \q, \qa

 ldrd \twiddle1, \twiddle2, [\twiddle_ptr], #8
 two_doublebutterfly_plant \c2, \c6, \c3, \c7, \twiddle1, \twiddle2, \tmp, \q, \qa
.endm

.macro _3_layer_double_inv_twist_16_plant c0, c1, c2, c3, c4, c5, c6, c7, twiddle1, twiddle2, twiddle_ptr, q, qa, tmp
 ldrd \twiddle1, \twiddle2, [\twiddle_ptr], #8
 mul_twiddle_plant \c0, \twiddle1, \tmp, \q, \qa
 mul_twiddle_plant \c1, \twiddle2, \tmp, \q, \qa
 ldrd \twiddle1, \twiddle2, [\twiddle_ptr], #8
 mul_twiddle_plant \c2, \twiddle1, \tmp, \q, \qa
 mul_twiddle_plant \c3, \twiddle2, \tmp, \q, \qa
 ldrd \twiddle1, \twiddle2, [\twiddle_ptr], #8
 mul_twiddle_plant \c4, \twiddle1, \tmp, \q, \qa
 mul_twiddle_plant \c5, \twiddle2, \tmp, \q, \qa
 ldrd \twiddle1, \twiddle2, [\twiddle_ptr], #8
 mul_twiddle_plant \c6, \twiddle1, \tmp, \q, \qa
 mul_twiddle_plant \c7, \twiddle2, \tmp, \q, \qa
.endm
# input coefficients < 0.5q
.global small_invntt_asm_769_opt_m7
.type small_invntt_asm_769_opt_m7, %function
.align 2
small_invntt_asm_769_opt_m7:
 push {r4-r11, r14}
 vpush.w {s16-s23}
 poly         .req r0
 twiddle_ptr  .req r1
 poly0        .req r2
 poly1        .req r3
 poly2        .req r4
 poly3        .req r5
 poly4        .req r6
 poly5        .req r7
 poly6        .req r8
 poly7        .req r9
 twiddle1     .req r10
 twiddle2     .req r11
 q            .req r12
 // at the top of r12
 qa           .req r0
 // qa=2^a q;a=3; at the bottom of r12
 tmp          .req r14

 movt q, #769

 ### LAYER 7+6+5+4
 .equ distance, 16
 .equ offset, 32
 .equ strincr, 64

 // pre-load twiddle factors to FPU registers
 vldm twiddle_ptr!, {s8-s22}

 add.w tmp, poly, #8*strincr
 vmov s8, tmp
 1:
        layer1234_start:
                                                     // Instructions:    218
                                                     // Expected cycles: 205
                                                     // Expected IPC:    1.06
                                                     //
                                                     // Wall time:     13.66s
                                                     // User time:     13.66s
                                                     //
                                                     // --------------------------------------------------------------------------------------------- cycle (expected) --------------------------------------------------------------------------------------------->
                                                     // 0                        25                       50                       75                       100                      125                      150                      175                      200
                                                     // |------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|----
        vmov s23, r0                                 // ......................*......................................................................................................................................................................................
        ldr.w r2, [r0, #offset]                      // .......................*.....................................................................................................................................................................................
        ldr.w r3, [r0, #distance/4+offset]           // .......................*.....................................................................................................................................................................................
        ldr.w r4, [r0, #2*distance/4+offset]         // ........................*....................................................................................................................................................................................
        ldr.w r5, [r0, #3*distance/4+offset]         // ........................*....................................................................................................................................................................................
        ldr.w r6, [r0, #distance+offset]             // .........................*...................................................................................................................................................................................
        ldr.w r7, [r0, #5*distance/4+offset]         // .........................*...................................................................................................................................................................................
        ldr.w r8, [r0, #6*distance/4+offset]         // ..........................*..................................................................................................................................................................................
        ldr.w r9, [r0, #7*distance/4+offset]         // ..........................*..................................................................................................................................................................................
        movw r0, #24608                              // ...........................*.................................................................................................................................................................................
        sadd16.w r14, r2, r3                         // ...........................*.................................................................................................................................................................................
        ssub16.w r3, r2, r3                          // ............................*................................................................................................................................................................................
        sadd16.w r11, r4, r5                         // ............................*................................................................................................................................................................................
        ssub16.w r5, r4, r5                          // .............................*...............................................................................................................................................................................
        sadd16.w r2, r6, r7                          // .............................*...............................................................................................................................................................................
        ssub16.w r7, r6, r7                          // ..............................*..............................................................................................................................................................................
        sadd16.w r4, r8, r9                          // ..............................*..............................................................................................................................................................................
        ssub16.w r9, r8, r9                          // ...............................*.............................................................................................................................................................................
        sadd16.w r8, r14, r11                        // ...............................*.............................................................................................................................................................................
        ssub16.w r11, r14, r11                       // ................................*............................................................................................................................................................................
        sadd16.w r6, r2, r4                          // ................................*............................................................................................................................................................................
        ssub16.w r4, r2, r4                          // .................................*...........................................................................................................................................................................
        vmov.w r10, s10                              // .................................*...........................................................................................................................................................................
        smulwb r14, r10, r5                          // ..................................*..........................................................................................................................................................................
        smulwt r5, r10, r5                           // ...................................*.........................................................................................................................................................................
        smlabt r14, r14, r12, r0                     // ....................................*........................................................................................................................................................................
        smlabt r5, r5, r12, r0                       // .....................................*.......................................................................................................................................................................
        pkhtb r14, r5, r14, asr #16                  // .......................................*.....................................................................................................................................................................
        usub16 r5, r3, r14                           // ........................................*....................................................................................................................................................................
        uadd16 r3, r3, r14                           // .........................................*...................................................................................................................................................................
        smulwb r14, r10, r9                          // .........................................*...................................................................................................................................................................
        smulwt r9, r10, r9                           // ..........................................*..................................................................................................................................................................
        smlabt r14, r14, r12, r0                     // ...........................................*.................................................................................................................................................................
        smlabt r9, r9, r12, r0                       // ............................................*................................................................................................................................................................
        pkhtb r14, r9, r14, asr #16                  // ..............................................*..............................................................................................................................................................
        usub16 r9, r7, r14                           // ...............................................*.............................................................................................................................................................
        uadd16 r7, r7, r14                           // ................................................*............................................................................................................................................................
        sadd16.w r2, r8, r6                          // ................................................*............................................................................................................................................................
        ssub16.w r6, r8, r6                          // .................................................*...........................................................................................................................................................
        vmov.w r10, s12                              // .................................................*...........................................................................................................................................................
        smulwb r14, r10, r7                          // ..................................................*..........................................................................................................................................................
        smulwt r7, r10, r7                           // ...................................................*.........................................................................................................................................................
        smlabt r14, r14, r12, r0                     // ....................................................*........................................................................................................................................................
        smlabt r7, r7, r12, r0                       // .....................................................*.......................................................................................................................................................
        pkhtb r14, r7, r14, asr #16                  // .......................................................*.....................................................................................................................................................
        usub16 r7, r3, r14                           // ........................................................*....................................................................................................................................................
        uadd16 r3, r3, r14                           // .........................................................*...................................................................................................................................................
        vmov.w r10, s13                              // .........................................................*...................................................................................................................................................
        smulwb r14, r10, r4                          // ..........................................................*..................................................................................................................................................
        smulwt r4, r10, r4                           // ...........................................................*.................................................................................................................................................
        smlabt r14, r14, r12, r0                     // ............................................................*................................................................................................................................................
        smlabt r4, r4, r12, r0                       // .............................................................*...............................................................................................................................................
        pkhtb r14, r4, r14, asr #16                  // ...............................................................*.............................................................................................................................................
        ssub16.w r8, r11, r14                        // ................................................................*............................................................................................................................................
        sadd16.w r4, r11, r14                        // .................................................................*...........................................................................................................................................
        vmov.w r10, s14                              // .................................................................*...........................................................................................................................................
        smulwb r14, r10, r9                          // ..................................................................*..........................................................................................................................................
        smulwt r9, r10, r9                           // ...................................................................*.........................................................................................................................................
        smlabt r14, r14, r12, r0                     // ....................................................................*........................................................................................................................................
        smlabt r9, r9, r12, r0                       // .....................................................................*.......................................................................................................................................
        pkhtb r14, r9, r14, asr #16                  // .......................................................................*.....................................................................................................................................
        usub16 r9, r5, r14                           // ........................................................................*....................................................................................................................................
        uadd16 r5, r5, r14                           // .........................................................................*...................................................................................................................................
        vmov r11, s16                                // .........................................................................*...................................................................................................................................
        smulwb r14, r11, r3                          // ..........................................................................*..................................................................................................................................
        smulwt r3, r11, r3                           // ...........................................................................*.................................................................................................................................
        smlabt r14, r14, r12, r0                     // ............................................................................*................................................................................................................................
        smlabt r3, r3, r12, r0                       // .............................................................................*...............................................................................................................................
        pkhtb r3, r3, r14, asr #16                   // ...............................................................................*.............................................................................................................................
        vmov r10, s17                                // ...............................................................................*.............................................................................................................................
        vmov r11, s18                                // ................................................................................*............................................................................................................................
        smulwb r14, r10, r4                          // ................................................................................*............................................................................................................................
        smulwt r4, r10, r4                           // .................................................................................*...........................................................................................................................
        smlabt r14, r14, r12, r0                     // ..................................................................................*..........................................................................................................................
        smlabt r4, r4, r12, r0                       // ...................................................................................*.........................................................................................................................
        pkhtb r4, r4, r14, asr #16                   // .....................................................................................*.......................................................................................................................
        smulwb r14, r11, r5                          // .....................................................................................*.......................................................................................................................
        smulwt r5, r11, r5                           // ......................................................................................*......................................................................................................................
        smlabt r14, r14, r12, r0                     // .......................................................................................*.....................................................................................................................
        smlabt r5, r5, r12, r0                       // ........................................................................................*....................................................................................................................
        pkhtb r5, r5, r14, asr #16                   // ..........................................................................................*..................................................................................................................
        vmov r10, s19                                // ..........................................................................................*..................................................................................................................
        vmov r11, s20                                // ...........................................................................................*.................................................................................................................
        smulwb r14, r10, r6                          // ...........................................................................................*.................................................................................................................
        smulwt r6, r10, r6                           // ............................................................................................*................................................................................................................
        smlabt r14, r14, r12, r0                     // .............................................................................................*...............................................................................................................
        smlabt r6, r6, r12, r0                       // ..............................................................................................*..............................................................................................................
        pkhtb r6, r6, r14, asr #16                   // ................................................................................................*............................................................................................................
        smulwb r14, r11, r7                          // ................................................................................................*............................................................................................................
        smulwt r7, r11, r7                           // .................................................................................................*...........................................................................................................
        smlabt r14, r14, r12, r0                     // ..................................................................................................*..........................................................................................................
        smlabt r7, r7, r12, r0                       // ...................................................................................................*.........................................................................................................
        pkhtb r7, r7, r14, asr #16                   // .....................................................................................................*.......................................................................................................
        vmov r10, s21                                // .....................................................................................................*.......................................................................................................
        vmov r11, s22                                // ......................................................................................................*......................................................................................................
        smulwb r14, r10, r8                          // ......................................................................................................*......................................................................................................
        smulwt r8, r10, r8                           // .......................................................................................................*.....................................................................................................
        smlabt r14, r14, r12, r0                     // ........................................................................................................*....................................................................................................
        smlabt r8, r8, r12, r0                       // .........................................................................................................*...................................................................................................
        pkhtb r8, r8, r14, asr #16                   // ...........................................................................................................*.................................................................................................
        smulwb r14, r11, r9                          // ...........................................................................................................*.................................................................................................
        smulwt r9, r11, r9                           // ............................................................................................................*................................................................................................
        smlabt r14, r14, r12, r0                     // .............................................................................................................*...............................................................................................
        smlabt r9, r9, r12, r0                       // ..............................................................................................................*..............................................................................................
        pkhtb r9, r9, r14, asr #16                   // ................................................................................................................*............................................................................................
        vmov s0, r2                                  // ................................................................................................................*............................................................................................
        vmov s1, r3                                  // .................................................................................................................*...........................................................................................
        vmov s2, r4                                  // ..................................................................................................................*..........................................................................................
        vmov s3, r5                                  // ...................................................................................................................*.........................................................................................
        vmov s4, r6                                  // ....................................................................................................................*........................................................................................
        vmov s5, r7                                  // .....................................................................................................................*.......................................................................................
        vmov s6, r8                                  // ......................................................................................................................*......................................................................................
        vmov s7, r9                                  // .......................................................................................................................*.....................................................................................
        vmov r0, s23                                 // ........................................................................................................................*....................................................................................
        ldr.w r2, [r0, #0]                           // .........................................................................................................................*...................................................................................
        ldr.w r3, [r0, #distance/4]                  // .........................................................................................................................*...................................................................................
        ldr.w r4, [r0, #2*distance/4]                // ..........................................................................................................................*..................................................................................
        ldr.w r5, [r0, #3*distance/4]                // ..........................................................................................................................*..................................................................................
        ldr.w r6, [r0, #distance]                    // ...........................................................................................................................*.................................................................................
        ldr.w r7, [r0, #5*distance/4]                // ...........................................................................................................................*.................................................................................
        ldr.w r8, [r0, #6*distance/4]                // ............................................................................................................................*................................................................................
        ldr.w r9, [r0, #7*distance/4]                // ............................................................................................................................*................................................................................
        movw r0, #24608                              // .............................................................................................................................*...............................................................................
        sadd16.w r14, r2, r3                         // .............................................................................................................................*...............................................................................
        ssub16.w r3, r2, r3                          // ..............................................................................................................................*..............................................................................
        sadd16.w r11, r4, r5                         // ..............................................................................................................................*..............................................................................
        ssub16.w r5, r4, r5                          // ...............................................................................................................................*.............................................................................
        sadd16.w r2, r6, r7                          // ...............................................................................................................................*.............................................................................
        ssub16.w r7, r6, r7                          // ................................................................................................................................*............................................................................
        sadd16.w r4, r8, r9                          // ................................................................................................................................*............................................................................
        ssub16.w r9, r8, r9                          // .................................................................................................................................*...........................................................................
        sadd16.w r8, r14, r11                        // .................................................................................................................................*...........................................................................
        ssub16.w r11, r14, r11                       // ..................................................................................................................................*..........................................................................
        sadd16.w r6, r2, r4                          // ..................................................................................................................................*..........................................................................
        ssub16.w r4, r2, r4                          // ...................................................................................................................................*.........................................................................
        vmov.w r10, s10                              // ...................................................................................................................................*.........................................................................
        smulwb r14, r10, r5                          // ....................................................................................................................................*........................................................................
        smulwt r5, r10, r5                           // .....................................................................................................................................*.......................................................................
        smlabt r14, r14, r12, r0                     // ......................................................................................................................................*......................................................................
        smlabt r5, r5, r12, r0                       // .......................................................................................................................................*.....................................................................
        pkhtb r14, r5, r14, asr #16                  // .........................................................................................................................................*...................................................................
        usub16 r5, r3, r14                           // ..........................................................................................................................................*..................................................................
        uadd16 r3, r3, r14                           // ...........................................................................................................................................*.................................................................
        smulwb r14, r10, r9                          // ...........................................................................................................................................*.................................................................
        smulwt r9, r10, r9                           // ............................................................................................................................................*................................................................
        smlabt r14, r14, r12, r0                     // .............................................................................................................................................*...............................................................
        smlabt r9, r9, r12, r0                       // ..............................................................................................................................................*..............................................................
        pkhtb r14, r9, r14, asr #16                  // ................................................................................................................................................*............................................................
        usub16 r9, r7, r14                           // .................................................................................................................................................*...........................................................
        uadd16 r7, r7, r14                           // ..................................................................................................................................................*..........................................................
        sadd16.w r2, r8, r6                          // ..................................................................................................................................................*..........................................................
        ssub16.w r6, r8, r6                          // ...................................................................................................................................................*.........................................................
        vmov.w r10, s12                              // ...................................................................................................................................................*.........................................................
        smulwb r14, r10, r7                          // ....................................................................................................................................................*........................................................
        smulwt r7, r10, r7                           // .....................................................................................................................................................*.......................................................
        smlabt r14, r14, r12, r0                     // ......................................................................................................................................................*......................................................
        smlabt r7, r7, r12, r0                       // .......................................................................................................................................................*.....................................................
        pkhtb r14, r7, r14, asr #16                  // .........................................................................................................................................................*...................................................
        usub16 r7, r3, r14                           // ..........................................................................................................................................................*..................................................
        uadd16 r3, r3, r14                           // ...........................................................................................................................................................*.................................................
        vmov.w r10, s13                              // ...........................................................................................................................................................*.................................................
        smulwb r14, r10, r4                          // ............................................................................................................................................................*................................................
        smulwt r4, r10, r4                           // .............................................................................................................................................................*...............................................
        smlabt r14, r14, r12, r0                     // ..............................................................................................................................................................*..............................................
        smlabt r4, r4, r12, r0                       // ...............................................................................................................................................................*.............................................
        pkhtb r14, r4, r14, asr #16                  // .................................................................................................................................................................*...........................................
        ssub16.w r8, r11, r14                        // ..................................................................................................................................................................*..........................................
        sadd16.w r4, r11, r14                        // ...................................................................................................................................................................*.........................................
        vmov.w r10, s14                              // ...................................................................................................................................................................*.........................................
        smulwb r14, r10, r9                          // ....................................................................................................................................................................*........................................
        smulwt r9, r10, r9                           // .....................................................................................................................................................................*.......................................
        smlabt r14, r14, r12, r0                     // ......................................................................................................................................................................*......................................
        smlabt r9, r9, r12, r0                       // .......................................................................................................................................................................*.....................................
        pkhtb r14, r9, r14, asr #16                  // .........................................................................................................................................................................*...................................
        usub16 r9, r5, r14                           // ..........................................................................................................................................................................*..................................
        uadd16 r5, r5, r14                           // ...........................................................................................................................................................................*.................................
        vmov r0, s23                                 // ...........................................................................................................................................................................*.................................
        vmov r11, s1                                 // ............................................................................................................................................................................*................................
        uadd16 r14, r3, r11                          // .............................................................................................................................................................................*...............................
        usub16 r3, r3, r11                           // ..............................................................................................................................................................................*..............................
        str.w r14, [r0, #1*distance/4]               // ..............................................................................................................................................................................*..............................
        str.w r3, [r0, #1*distance/4+offset]         // ................................................................................................................................................................................*............................
        vmov r11, s3                                 // ................................................................................................................................................................................*............................
        uadd16 r14, r5, r11                          // .................................................................................................................................................................................*...........................
        usub16 r5, r5, r11                           // ..................................................................................................................................................................................*..........................
        str.w r14, [r0, #3*distance/4]               // ..................................................................................................................................................................................*..........................
        str.w r5, [r0, #3*distance/4+offset]         // ....................................................................................................................................................................................*........................
        vmov r11, s5                                 // ....................................................................................................................................................................................*........................
        uadd16 r14, r7, r11                          // .....................................................................................................................................................................................*.......................
        usub16 r7, r7, r11                           // ......................................................................................................................................................................................*......................
        str.w r14, [r0, #5*distance/4]               // ......................................................................................................................................................................................*......................
        str.w r7, [r0, #5*distance/4+offset]         // ........................................................................................................................................................................................*....................
        vmov r11, s7                                 // ........................................................................................................................................................................................*....................
        uadd16 r14, r9, r11                          // .........................................................................................................................................................................................*...................
        usub16 r9, r9, r11                           // ..........................................................................................................................................................................................*..................
        str.w r14, [r0, #7*distance/4]               // ..........................................................................................................................................................................................*..................
        str.w r9, [r0, #7*distance/4+offset]         // ............................................................................................................................................................................................*................
        vmov r5, s2                                  // ............................................................................................................................................................................................*................
        uadd16 r14, r4, r5                           // .............................................................................................................................................................................................*...............
        usub16 r11, r4, r5                           // ..............................................................................................................................................................................................*..............
        str.w r14, [r0, #2*distance/4]               // ..............................................................................................................................................................................................*..............
        str.w r11, [r0, #2*distance/4+offset]        // ................................................................................................................................................................................................*............
        vmov r7, s4                                  // ................................................................................................................................................................................................*............
        uadd16 r14, r6, r7                           // .................................................................................................................................................................................................*...........
        usub16 r11, r6, r7                           // ..................................................................................................................................................................................................*..........
        str.w r14, [r0, #4*distance/4]               // ..................................................................................................................................................................................................*..........
        str.w r11, [r0, #4*distance/4+offset]        // ....................................................................................................................................................................................................*........
        vmov r9, s6                                  // ....................................................................................................................................................................................................*........
        uadd16 r14, r8, r9                           // .....................................................................................................................................................................................................*.......
        usub16 r11, r8, r9                           // ......................................................................................................................................................................................................*......
        str.w r14, [r0, #6*distance/4]               // ......................................................................................................................................................................................................*......
        str.w r11, [r0, #6*distance/4+offset]        // ........................................................................................................................................................................................................*....
        vmov r3, s0                                  // ........................................................................................................................................................................................................*....
        uadd16 r14, r2, r3                           // .........................................................................................................................................................................................................*...
        usub16 r11, r2, r3                           // ..........................................................................................................................................................................................................*..
        str.w r11, [r0, #offset]                     // ..........................................................................................................................................................................................................*..
        str.w r14, [r0], #strincr                    // ............................................................................................................................................................................................................*
        vmov r14, s8                                 // ............................................................................................................................................................................................................*

                                                      // ---------------------------------------------------------------------------------- cycle (expected) ---------------------------------------------------------------------------------->
                                                      // 0                        25                       50                       75                       100                      125                      150                      175
                                                      // |------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|-------
        // vmov s23, r0                               // *......................................................................................................................................................................................
        // ldr.w r2, [r0, #offset]                    // .*.....................................................................................................................................................................................
        // ldr.w r3, [r0, #distance/4+offset]         // .*.....................................................................................................................................................................................
        // ldr.w r4, [r0, #2*distance/4+offset]       // ..*....................................................................................................................................................................................
        // ldr.w r5, [r0, #3*distance/4+offset]       // ..*....................................................................................................................................................................................
        // ldr.w r6, [r0, #distance+offset]           // ...*...................................................................................................................................................................................
        // ldr.w r7, [r0, #5*distance/4+offset]       // ...*...................................................................................................................................................................................
        // ldr.w r8, [r0, #6*distance/4+offset]       // ....*..................................................................................................................................................................................
        // ldr.w r9, [r0, #7*distance/4+offset]       // ....*..................................................................................................................................................................................
        // movw r0, #24608                            // .....*.................................................................................................................................................................................
        // sadd16.w r14, r2, r3                       // .....*.................................................................................................................................................................................
        // ssub16.w r3, r2, r3                        // ......*................................................................................................................................................................................
        // sadd16.w r11, r4, r5                       // ......*................................................................................................................................................................................
        // ssub16.w r5, r4, r5                        // .......*...............................................................................................................................................................................
        // sadd16.w r2, r6, r7                        // .......*...............................................................................................................................................................................
        // ssub16.w r7, r6, r7                        // ........*..............................................................................................................................................................................
        // sadd16.w r4, r8, r9                        // ........*..............................................................................................................................................................................
        // ssub16.w r9, r8, r9                        // .........*.............................................................................................................................................................................
        // sadd16.w r8, r14, r11                      // .........*.............................................................................................................................................................................
        // ssub16.w r11, r14, r11                     // ..........*............................................................................................................................................................................
        // sadd16.w r6, r2, r4                        // ..........*............................................................................................................................................................................
        // ssub16.w r4, r2, r4                        // ...........*...........................................................................................................................................................................
        // vmov.w r10, s10                            // ...........*...........................................................................................................................................................................
        // smulwb r14, r10, r5                        // ............*..........................................................................................................................................................................
        // smulwt r5, r10, r5                         // .............*.........................................................................................................................................................................
        // smlabt r14, r14, r12, r0                   // ..............*........................................................................................................................................................................
        // smlabt r5, r5, r12, r0                     // ...............*.......................................................................................................................................................................
        // pkhtb r14, r5, r14, asr #16                // .................*.....................................................................................................................................................................
        // usub16 r5, r3, r14                         // ..................*....................................................................................................................................................................
        // uadd16 r3, r3, r14                         // ...................*...................................................................................................................................................................
        // smulwb r14, r10, r9                        // ...................*...................................................................................................................................................................
        // smulwt r9, r10, r9                         // ....................*..................................................................................................................................................................
        // smlabt r14, r14, r12, r0                   // .....................*.................................................................................................................................................................
        // smlabt r9, r9, r12, r0                     // ......................*................................................................................................................................................................
        // pkhtb r14, r9, r14, asr #16                // ........................*..............................................................................................................................................................
        // usub16 r9, r7, r14                         // .........................*.............................................................................................................................................................
        // uadd16 r7, r7, r14                         // ..........................*............................................................................................................................................................
        // sadd16.w r2, r8, r6                        // ..........................*............................................................................................................................................................
        // ssub16.w r6, r8, r6                        // ...........................*...........................................................................................................................................................
        // vmov.w r10, s12                            // ...........................*...........................................................................................................................................................
        // smulwb r14, r10, r7                        // ............................*..........................................................................................................................................................
        // smulwt r7, r10, r7                         // .............................*.........................................................................................................................................................
        // smlabt r14, r14, r12, r0                   // ..............................*........................................................................................................................................................
        // smlabt r7, r7, r12, r0                     // ...............................*.......................................................................................................................................................
        // pkhtb r14, r7, r14, asr #16                // .................................*.....................................................................................................................................................
        // usub16 r7, r3, r14                         // ..................................*....................................................................................................................................................
        // uadd16 r3, r3, r14                         // ...................................*...................................................................................................................................................
        // vmov.w r10, s13                            // ...................................*...................................................................................................................................................
        // smulwb r14, r10, r4                        // ....................................*..................................................................................................................................................
        // smulwt r4,  r10, r4                        // .....................................*.................................................................................................................................................
        // smlabt r14, r14, r12, r0                   // ......................................*................................................................................................................................................
        // smlabt r4, r4, r12, r0                     // .......................................*...............................................................................................................................................
        // pkhtb r14, r4, r14, asr #16                // .........................................*.............................................................................................................................................
        // ssub16.w r8, r11, r14                      // ..........................................*............................................................................................................................................
        // sadd16.w r4, r11, r14                      // ...........................................*...........................................................................................................................................
        // vmov.w r10, s14                            // ...........................................*...........................................................................................................................................
        // smulwb r14, r10, r9                        // ............................................*..........................................................................................................................................
        // smulwt r9, r10, r9                         // .............................................*.........................................................................................................................................
        // smlabt r14, r14, r12, r0                   // ..............................................*........................................................................................................................................
        // smlabt r9, r9, r12, r0                     // ...............................................*.......................................................................................................................................
        // pkhtb r14, r9, r14, asr #16                // .................................................*.....................................................................................................................................
        // usub16 r9, r5, r14                         // ..................................................*....................................................................................................................................
        // uadd16 r5, r5, r14                         // ...................................................*...................................................................................................................................
        // vmov r11, s16                              // ...................................................*...................................................................................................................................
        // smulwb r14, r11, r3                        // ....................................................*..................................................................................................................................
        // smulwt r3,   r11, r3                       // .....................................................*.................................................................................................................................
        // smlabt r14, r14, r12, r0                   // ......................................................*................................................................................................................................
        // smlabt r3, r3, r12, r0                     // .......................................................*...............................................................................................................................
        // pkhtb r3, r3, r14, asr #16                 // .........................................................*.............................................................................................................................
        // vmov r10, s17                              // .........................................................*.............................................................................................................................
        // vmov r11, s18                              // ..........................................................*............................................................................................................................
        // smulwb r14, r10, r4                        // ..........................................................*............................................................................................................................
        // smulwt r4,   r10, r4                       // ...........................................................*...........................................................................................................................
        // smlabt r14, r14, r12, r0                   // ............................................................*..........................................................................................................................
        // smlabt r4, r4, r12, r0                     // .............................................................*.........................................................................................................................
        // pkhtb r4, r4, r14, asr #16                 // ...............................................................*.......................................................................................................................
        // smulwb r14, r11, r5                        // ...............................................................*.......................................................................................................................
        // smulwt r5,   r11, r5                       // ................................................................*......................................................................................................................
        // smlabt r14, r14, r12, r0                   // .................................................................*.....................................................................................................................
        // smlabt r5, r5, r12, r0                     // ..................................................................*....................................................................................................................
        // pkhtb r5, r5, r14, asr #16                 // ....................................................................*..................................................................................................................
        // vmov r10, s19                              // ....................................................................*..................................................................................................................
        // vmov r11, s20                              // .....................................................................*.................................................................................................................
        // smulwb r14, r10, r6                        // .....................................................................*.................................................................................................................
        // smulwt r6,   r10, r6                       // ......................................................................*................................................................................................................
        // smlabt r14, r14, r12, r0                   // .......................................................................*...............................................................................................................
        // smlabt r6, r6, r12, r0                     // ........................................................................*..............................................................................................................
        // pkhtb r6, r6, r14, asr #16                 // ..........................................................................*............................................................................................................
        // smulwb r14, r11, r7                        // ..........................................................................*............................................................................................................
        // smulwt r7,   r11, r7                       // ...........................................................................*...........................................................................................................
        // smlabt r14, r14, r12, r0                   // ............................................................................*..........................................................................................................
        // smlabt r7, r7, r12, r0                     // .............................................................................*.........................................................................................................
        // pkhtb r7, r7, r14, asr #16                 // ...............................................................................*.......................................................................................................
        // vmov r10, s21                              // ...............................................................................*.......................................................................................................
        // vmov r11, s22                              // ................................................................................*......................................................................................................
        // smulwb r14, r10, r8                        // ................................................................................*......................................................................................................
        // smulwt r8,   r10, r8                       // .................................................................................*.....................................................................................................
        // smlabt r14, r14, r12, r0                   // ..................................................................................*....................................................................................................
        // smlabt r8, r8, r12, r0                     // ...................................................................................*...................................................................................................
        // pkhtb r8, r8, r14, asr #16                 // .....................................................................................*.................................................................................................
        // smulwb r14, r11, r9                        // .....................................................................................*.................................................................................................
        // smulwt r9,   r11, r9                       // ......................................................................................*................................................................................................
        // smlabt r14, r14, r12, r0                   // .......................................................................................*...............................................................................................
        // smlabt r9, r9, r12, r0                     // ........................................................................................*..............................................................................................
        // pkhtb r9, r9, r14, asr #16                 // ..........................................................................................*............................................................................................
        // vmov s0, r2                                // ..........................................................................................*............................................................................................
        // vmov s1, r3                                // ...........................................................................................*...........................................................................................
        // vmov s2, r4                                // ............................................................................................*..........................................................................................
        // vmov s3, r5                                // .............................................................................................*.........................................................................................
        // vmov s4, r6                                // ..............................................................................................*........................................................................................
        // vmov s5, r7                                // ...............................................................................................*.......................................................................................
        // vmov s6, r8                                // ................................................................................................*......................................................................................
        // vmov s7, r9                                // .................................................................................................*.....................................................................................
        // vmov r0, s23                               // ..................................................................................................*....................................................................................
        // ldr.w r2, [r0, #0]                         // ...................................................................................................*...................................................................................
        // ldr.w r3, [r0, #distance/4]                // ...................................................................................................*...................................................................................
        // ldr.w r4, [r0, #2*distance/4]              // ....................................................................................................*..................................................................................
        // ldr.w r5, [r0, #3*distance/4]              // ....................................................................................................*..................................................................................
        // ldr.w r6, [r0, #distance]                  // .....................................................................................................*.................................................................................
        // ldr.w r7, [r0, #5*distance/4]              // .....................................................................................................*.................................................................................
        // ldr.w r8, [r0, #6*distance/4]              // ......................................................................................................*................................................................................
        // ldr.w r9, [r0, #7*distance/4]              // ......................................................................................................*................................................................................
        // movw r0, #24608                            // .......................................................................................................*...............................................................................
        // sadd16.w r14, r2, r3                       // .......................................................................................................*...............................................................................
        // ssub16.w r3, r2, r3                        // ........................................................................................................*..............................................................................
        // sadd16.w r11, r4, r5                       // ........................................................................................................*..............................................................................
        // ssub16.w r5, r4, r5                        // .........................................................................................................*.............................................................................
        // sadd16.w r2, r6, r7                        // .........................................................................................................*.............................................................................
        // ssub16.w r7, r6, r7                        // ..........................................................................................................*............................................................................
        // sadd16.w r4, r8, r9                        // ..........................................................................................................*............................................................................
        // ssub16.w r9, r8, r9                        // ...........................................................................................................*...........................................................................
        // sadd16.w r8, r14, r11                      // ...........................................................................................................*...........................................................................
        // ssub16.w r11, r14, r11                     // ............................................................................................................*..........................................................................
        // sadd16.w r6, r2, r4                        // ............................................................................................................*..........................................................................
        // ssub16.w r4, r2, r4                        // .............................................................................................................*.........................................................................
        // vmov.w r10, s10                            // .............................................................................................................*.........................................................................
        // smulwb r14, r10, r5                        // ..............................................................................................................*........................................................................
        // smulwt r5, r10, r5                         // ...............................................................................................................*.......................................................................
        // smlabt r14, r14, r12, r0                   // ................................................................................................................*......................................................................
        // smlabt r5, r5, r12, r0                     // .................................................................................................................*.....................................................................
        // pkhtb r14, r5, r14, asr #16                // ...................................................................................................................*...................................................................
        // usub16 r5, r3, r14                         // ....................................................................................................................*..................................................................
        // uadd16 r3, r3, r14                         // .....................................................................................................................*.................................................................
        // smulwb r14, r10, r9                        // .....................................................................................................................*.................................................................
        // smulwt r9, r10, r9                         // ......................................................................................................................*................................................................
        // smlabt r14, r14, r12, r0                   // .......................................................................................................................*...............................................................
        // smlabt r9, r9, r12, r0                     // ........................................................................................................................*..............................................................
        // pkhtb r14, r9, r14, asr #16                // ..........................................................................................................................*............................................................
        // usub16 r9, r7, r14                         // ...........................................................................................................................*...........................................................
        // uadd16 r7, r7, r14                         // ............................................................................................................................*..........................................................
        // sadd16.w r2, r8, r6                        // ............................................................................................................................*..........................................................
        // ssub16.w r6, r8, r6                        // .............................................................................................................................*.........................................................
        // vmov.w r10, s12                            // .............................................................................................................................*.........................................................
        // smulwb r14, r10, r7                        // ..............................................................................................................................*........................................................
        // smulwt r7, r10, r7                         // ...............................................................................................................................*.......................................................
        // smlabt r14, r14, r12, r0                   // ................................................................................................................................*......................................................
        // smlabt r7, r7, r12, r0                     // .................................................................................................................................*.....................................................
        // pkhtb r14, r7, r14, asr #16                // ...................................................................................................................................*...................................................
        // usub16 r7, r3, r14                         // ....................................................................................................................................*..................................................
        // uadd16 r3, r3, r14                         // .....................................................................................................................................*.................................................
        // vmov.w r10, s13                            // .....................................................................................................................................*.................................................
        // smulwb r14, r10, r4                        // ......................................................................................................................................*................................................
        // smulwt r4,  r10, r4                        // .......................................................................................................................................*...............................................
        // smlabt r14, r14, r12, r0                   // ........................................................................................................................................*..............................................
        // smlabt r4, r4, r12, r0                     // .........................................................................................................................................*.............................................
        // pkhtb r14, r4, r14, asr #16                // ...........................................................................................................................................*...........................................
        // ssub16.w r8, r11, r14                      // ............................................................................................................................................*..........................................
        // sadd16.w r4, r11, r14                      // .............................................................................................................................................*.........................................
        // vmov.w r10, s14                            // .............................................................................................................................................*.........................................
        // smulwb r14, r10, r9                        // ..............................................................................................................................................*........................................
        // smulwt r9, r10, r9                         // ...............................................................................................................................................*.......................................
        // smlabt r14, r14, r12, r0                   // ................................................................................................................................................*......................................
        // smlabt r9, r9, r12, r0                     // .................................................................................................................................................*.....................................
        // pkhtb r14, r9, r14, asr #16                // ...................................................................................................................................................*...................................
        // usub16 r9, r5, r14                         // ....................................................................................................................................................*..................................
        // uadd16 r5, r5, r14                         // .....................................................................................................................................................*.................................
        // vmov r0, s23                               // .....................................................................................................................................................*.................................
        // vmov r11, s1                               // ......................................................................................................................................................*................................
        // uadd16 r14, r3, r11                        // .......................................................................................................................................................*...............................
        // usub16 r3, r3, r11                         // ........................................................................................................................................................*..............................
        // str.w r14, [r0, #1*distance/4]             // ........................................................................................................................................................*..............................
        // str.w r3, [r0, #1*distance/4+offset]       // ..........................................................................................................................................................*............................
        // vmov r11, s3                               // ..........................................................................................................................................................*............................
        // uadd16 r14, r5, r11                        // ...........................................................................................................................................................*...........................
        // usub16 r5, r5, r11                         // ............................................................................................................................................................*..........................
        // str.w r14, [r0, #3*distance/4]             // ............................................................................................................................................................*..........................
        // str.w r5, [r0, #3*distance/4+offset]       // ..............................................................................................................................................................*........................
        // vmov r11, s5                               // ..............................................................................................................................................................*........................
        // uadd16 r14, r7, r11                        // ...............................................................................................................................................................*.......................
        // usub16 r7, r7, r11                         // ................................................................................................................................................................*......................
        // str.w r14, [r0, #5*distance/4]             // ................................................................................................................................................................*......................
        // str.w r7, [r0, #5*distance/4+offset]       // ..................................................................................................................................................................*....................
        // vmov r11, s7                               // ..................................................................................................................................................................*....................
        // uadd16 r14, r9, r11                        // ...................................................................................................................................................................*...................
        // usub16 r9, r9, r11                         // ....................................................................................................................................................................*..................
        // str.w r14, [r0, #7*distance/4]             // ....................................................................................................................................................................*..................
        // str.w r9, [r0, #7*distance/4+offset]       // ......................................................................................................................................................................*................
        // vmov r5, s2                                // ......................................................................................................................................................................*................
        // uadd16 r14, r4, r5                         // .......................................................................................................................................................................*...............
        // usub16 r11, r4, r5                         // ........................................................................................................................................................................*..............
        // str.w r14, [r0, #2*distance/4]             // ........................................................................................................................................................................*..............
        // str.w r11, [r0, #2*distance/4+offset]      // ..........................................................................................................................................................................*............
        // vmov r7, s4                                // ..........................................................................................................................................................................*............
        // uadd16 r14, r6, r7                         // ...........................................................................................................................................................................*...........
        // usub16 r11, r6, r7                         // ............................................................................................................................................................................*..........
        // str.w r14, [r0, #4*distance/4]             // ............................................................................................................................................................................*..........
        // str.w r11, [r0, #4*distance/4+offset]      // ..............................................................................................................................................................................*........
        // vmov r9, s6                                // ..............................................................................................................................................................................*........
        // uadd16 r14, r8, r9                         // ...............................................................................................................................................................................*.......
        // usub16 r11, r8, r9                         // ................................................................................................................................................................................*......
        // str.w r14, [r0, #6*distance/4]             // ................................................................................................................................................................................*......
        // str.w r11, [r0, #6*distance/4+offset]      // ..................................................................................................................................................................................*....
        // vmov r3, s0                                // ..................................................................................................................................................................................*....
        // uadd16 r14, r2, r3                         // ...................................................................................................................................................................................*...
        // usub16 r11, r2, r3                         // ....................................................................................................................................................................................*..
        // str.w r11, [r0, #offset]                   // ....................................................................................................................................................................................*..
        // str.w r14, [r0], #strincr                  // ......................................................................................................................................................................................*
        // vmov r14, s8                               // ......................................................................................................................................................................................*

        layer1234_end:


 cmp.w poly, tmp
 bne.w 1b

 sub.w poly, #8*strincr

 ### LAYER 3+2+1

 .equ distance, distance*16
 .equ strincr, 4

 // ITER 0
 vmov s6, poly
 load poly, poly0, poly1, poly2, poly3, #0, #distance/4, #2*distance/4, #3*distance/4
 load poly, poly4, poly5, poly6, poly7, #distance, #5*distance/4, #6*distance/4, #7*distance/4

 vldm twiddle_ptr!, {s0-s5}
 movw qa, #24608
 // twiddle2 is used as tmp2
 _3_layer_double_inv_CT_16_plant_light poly0, poly1, poly2, poly3, poly4, poly5, poly6, poly7, s1, s3, s4, s5, twiddle1, twiddle2, q, qa, tmp

 // twisting
 _3_layer_double_inv_twist_16_plant poly0, poly1, poly2, poly3, poly4, poly5, poly6, poly7, twiddle1, twiddle2, twiddle_ptr, q, qa, tmp

 vmov poly, s6
 store poly, poly4, poly5, poly6, poly7, #distance, #5*distance/4, #6*distance/4, #7*distance/4
 str.w poly1, [poly, #distance/4]
 str.w poly2, [poly, #2*distance/4]
 str.w poly3, [poly, #3*distance/4]
 str.w poly0, [poly], #4

 // ITER 1-15
 add.w tmp, poly, #strincr*3*(5)
 vmov s14, tmp
 2:
        layer567_start:
                                             // Instructions:    152
                                             // Expected cycles: 168
                                             // Expected IPC:    0.90
                                             //
                                             // Wall time:     0.93s
                                             // User time:     0.93s
                                             //
                                             // -------------------------------------------------------------------------- cycle (expected) --------------------------------------------------------------------------->
                                             // 0                        25                       50                       75                       100                      125                      150
                                             // |------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|-----------------
        vmov s6, r0                          // *.......................................................................................................................................................................
        ldr.w r2, [r0, #0]                   // *.......................................................................................................................................................................
        ldr.w r3, [r0, #distance/4]          // .*......................................................................................................................................................................
        ldr.w r4, [r0, #2*distance/4]        // ..*.....................................................................................................................................................................
        ldr.w r5, [r0, #3*distance/4]        // ..*.....................................................................................................................................................................
        ldr.w r6, [r0, #distance]            // ...*....................................................................................................................................................................
        ldr.w r7, [r0, #5*distance/4]        // ...*....................................................................................................................................................................
        ldr.w r8, [r0, #6*distance/4]        // ....*...................................................................................................................................................................
        ldr.w r9, [r0, #7*distance/4]        // ....*...................................................................................................................................................................
        movw r0, #24608                      // .....*..................................................................................................................................................................
        ldr.w r10, [r1], #4                  // .....*..................................................................................................................................................................
        smulwb r14, r10, r3                  // .......*................................................................................................................................................................
        smulwt r3, r10, r3                   // ........*...............................................................................................................................................................
        smlabt r14, r14, r12, r0             // .........*..............................................................................................................................................................
        smlabt r3, r3, r12, r0               // ..........*.............................................................................................................................................................
        pkhtb r14, r3, r14, asr #16          // ............*...........................................................................................................................................................
        usub16 r3, r2, r14                   // .............*..........................................................................................................................................................
        uadd16 r2, r2, r14                   // ..............*.........................................................................................................................................................
        smulwb r14, r10, r5                  // ..............*.........................................................................................................................................................
        smulwt r5, r10, r5                   // ...............*........................................................................................................................................................
        smlabt r14, r14, r12, r0             // ................*.......................................................................................................................................................
        smlabt r5, r5, r12, r0               // .................*......................................................................................................................................................
        pkhtb r14, r5, r14, asr #16          // ...................*....................................................................................................................................................
        usub16 r5, r4, r14                   // ....................*...................................................................................................................................................
        uadd16 r4, r4, r14                   // .....................*..................................................................................................................................................
        smulwb r14, r10, r7                  // .....................*..................................................................................................................................................
        smulwt r7, r10, r7                   // ......................*.................................................................................................................................................
        smlabt r14, r14, r12, r0             // .......................*................................................................................................................................................
        smlabt r7, r7, r12, r0               // ........................*...............................................................................................................................................
        pkhtb r14, r7, r14, asr #16          // ..........................*.............................................................................................................................................
        usub16 r7, r6, r14                   // ...........................*............................................................................................................................................
        uadd16 r6, r6, r14                   // ............................*...........................................................................................................................................
        smulwb r14, r10, r9                  // ............................*...........................................................................................................................................
        smulwt r9, r10, r9                   // .............................*..........................................................................................................................................
        smlabt r14, r14, r12, r0             // ..............................*.........................................................................................................................................
        smlabt r9, r9, r12, r0               // ...............................*........................................................................................................................................
        pkhtb r14, r9, r14, asr #16          // .................................*......................................................................................................................................
        usub16 r9, r8, r14                   // ..................................*.....................................................................................................................................
        uadd16 r8, r8, r14                   // ...................................*....................................................................................................................................
        ldrd r10, r11, [r1], #8              // ...................................*....................................................................................................................................
        smulwb r14, r10, r4                  // ......................................*.................................................................................................................................
        smulwt r4, r10, r4                   // .......................................*................................................................................................................................
        smlabt r14, r14, r12, r0             // ........................................*...............................................................................................................................
        smlabt r4, r4, r12, r0               // .........................................*..............................................................................................................................
        pkhtb r14, r4, r14, asr #16          // ...........................................*............................................................................................................................
        usub16 r4, r2, r14                   // ............................................*...........................................................................................................................
        uadd16 r2, r2, r14                   // ............................................*...........................................................................................................................
        smulwb r14, r11, r5                  // .............................................*..........................................................................................................................
        smulwt r5, r11, r5                   // ..............................................*.........................................................................................................................
        smlabt r14, r14, r12, r0             // ...............................................*........................................................................................................................
        smlabt r5, r5, r12, r0               // ................................................*.......................................................................................................................
        pkhtb r14, r5, r14, asr #16          // ..................................................*.....................................................................................................................
        usub16 r5, r3, r14                   // ...................................................*....................................................................................................................
        uadd16 r3, r3, r14                   // ...................................................*....................................................................................................................
        smulwb r14, r10, r8                  // ....................................................*...................................................................................................................
        smulwt r8, r10, r8                   // .....................................................*..................................................................................................................
        smlabt r14, r14, r12, r0             // ......................................................*.................................................................................................................
        smlabt r8, r8, r12, r0               // .......................................................*................................................................................................................
        pkhtb r14, r8, r14, asr #16          // .........................................................*..............................................................................................................
        usub16 r8, r6, r14                   // ..........................................................*.............................................................................................................
        uadd16 r6, r6, r14                   // ..........................................................*.............................................................................................................
        smulwb r14, r11, r9                  // ...........................................................*............................................................................................................
        smulwt r9, r11, r9                   // ............................................................*...........................................................................................................
        smlabt r14, r14, r12, r0             // .............................................................*..........................................................................................................
        smlabt r9, r9, r12, r0               // ..............................................................*.........................................................................................................
        pkhtb r14, r9, r14, asr #16          // ................................................................*.......................................................................................................
        usub16 r9, r7, r14                   // .................................................................*......................................................................................................
        uadd16 r7, r7, r14                   // .................................................................*......................................................................................................
        ldrd r10, r11, [r1], #8              // ..................................................................*.....................................................................................................
        smulwb r14, r10, r6                  // .....................................................................*..................................................................................................
        smulwt r6, r10, r6                   // ......................................................................*.................................................................................................
        smlabt r14, r14, r12, r0             // .......................................................................*................................................................................................
        smlabt r6, r6, r12, r0               // ........................................................................*...............................................................................................
        pkhtb r14, r6, r14, asr #16          // ..........................................................................*.............................................................................................
        usub16 r6, r2, r14                   // ...........................................................................*............................................................................................
        uadd16 r2, r2, r14                   // ...........................................................................*............................................................................................
        smulwb r14, r11, r7                  // ............................................................................*...........................................................................................
        smulwt r7, r11, r7                   // .............................................................................*..........................................................................................
        smlabt r14, r14, r12, r0             // ..............................................................................*.........................................................................................
        smlabt r7, r7, r12, r0               // ...............................................................................*........................................................................................
        pkhtb r14, r7, r14, asr #16          // .................................................................................*......................................................................................
        usub16 r7, r3, r14                   // ..................................................................................*.....................................................................................
        uadd16 r3, r3, r14                   // ...................................................................................*....................................................................................
        ldrd r10, r11, [r1], #8              // ...................................................................................*....................................................................................
        smulwb r14, r10, r8                  // ......................................................................................*.................................................................................
        smulwt r8, r10, r8                   // .......................................................................................*................................................................................
        smlabt r14, r14, r12, r0             // ........................................................................................*...............................................................................
        smlabt r8, r8, r12, r0               // .........................................................................................*..............................................................................
        pkhtb r14, r8, r14, asr #16          // ...........................................................................................*............................................................................
        usub16 r8, r4, r14                   // ............................................................................................*...........................................................................
        uadd16 r4, r4, r14                   // ............................................................................................*...........................................................................
        smulwb r14, r11, r9                  // .............................................................................................*..........................................................................
        smulwt r9, r11, r9                   // ..............................................................................................*.........................................................................
        smlabt r14, r14, r12, r0             // ...............................................................................................*........................................................................
        smlabt r9, r9, r12, r0               // ................................................................................................*.......................................................................
        pkhtb r14, r9, r14, asr #16          // ..................................................................................................*.....................................................................
        usub16 r9, r5, r14                   // ...................................................................................................*....................................................................
        uadd16 r5, r5, r14                   // ....................................................................................................*...................................................................
        ldrd r10, r11, [r1], #8              // ....................................................................................................*...................................................................
        smulwb r14, r10, r2                  // .......................................................................................................*................................................................
        smulwt r2, r10, r2                   // ........................................................................................................*...............................................................
        smlabt r14, r14, r12, r0             // .........................................................................................................*..............................................................
        smlabt r2, r2, r12, r0               // ..........................................................................................................*.............................................................
        pkhtb r2, r2, r14, asr #16           // ............................................................................................................*...........................................................
        smulwb r14, r11, r3                  // ............................................................................................................*...........................................................
        smulwt r3, r11, r3                   // .............................................................................................................*..........................................................
        smlabt r14, r14, r12, r0             // ..............................................................................................................*.........................................................
        smlabt r3, r3, r12, r0               // ...............................................................................................................*........................................................
        pkhtb r3, r3, r14, asr #16           // .................................................................................................................*......................................................
        ldrd r10, r11, [r1], #8              // .................................................................................................................*......................................................
        smulwb r14, r10, r4                  // ....................................................................................................................*...................................................
        smulwt r4, r10, r4                   // .....................................................................................................................*..................................................
        smlabt r14, r14, r12, r0             // ......................................................................................................................*.................................................
        smlabt r4, r4, r12, r0               // .......................................................................................................................*................................................
        pkhtb r4, r4, r14, asr #16           // .........................................................................................................................*..............................................
        smulwb r14, r11, r5                  // .........................................................................................................................*..............................................
        smulwt r5, r11, r5                   // ..........................................................................................................................*.............................................
        smlabt r14, r14, r12, r0             // ...........................................................................................................................*............................................
        smlabt r5, r5, r12, r0               // ............................................................................................................................*...........................................
        pkhtb r5, r5, r14, asr #16           // ..............................................................................................................................*.........................................
        ldrd r10, r11, [r1], #8              // ..............................................................................................................................*.........................................
        smulwb r14, r10, r6                  // .................................................................................................................................*......................................
        smulwt r6, r10, r6                   // ..................................................................................................................................*.....................................
        smlabt r14, r14, r12, r0             // ...................................................................................................................................*....................................
        smlabt r6, r6, r12, r0               // ....................................................................................................................................*...................................
        pkhtb r6, r6, r14, asr #16           // ......................................................................................................................................*.................................
        smulwb r14, r11, r7                  // ......................................................................................................................................*.................................
        smulwt r7, r11, r7                   // .......................................................................................................................................*................................
        smlabt r14, r14, r12, r0             // ........................................................................................................................................*...............................
        smlabt r7, r7, r12, r0               // .........................................................................................................................................*..............................
        pkhtb r7, r7, r14, asr #16           // ...........................................................................................................................................*............................
        ldrd r10, r11, [r1], #8              // ...........................................................................................................................................*............................
        smulwb r14, r10, r8                  // ..............................................................................................................................................*.........................
        smulwt r8, r10, r8                   // ...............................................................................................................................................*........................
        smlabt r14, r14, r12, r0             // ................................................................................................................................................*.......................
        smlabt r8, r8, r12, r0               // .................................................................................................................................................*......................
        pkhtb r8, r8, r14, asr #16           // ...................................................................................................................................................*....................
        smulwb r14, r11, r9                  // ...................................................................................................................................................*....................
        smulwt r9, r11, r9                   // ....................................................................................................................................................*...................
        smlabt r14, r14, r12, r0             // .....................................................................................................................................................*..................
        smlabt r9, r9, r12, r0               // ......................................................................................................................................................*.................
        pkhtb r9, r9, r14, asr #16           // ........................................................................................................................................................*...............
        vmov r0, s6                          // ........................................................................................................................................................*...............
        str.w r6, [r0, #distance]            // .........................................................................................................................................................*..............
        str.w r7, [r0, #5*distance/4]        // ...........................................................................................................................................................*............
        str.w r8, [r0, #6*distance/4]        // .............................................................................................................................................................*..........
        str.w r9, [r0, #7*distance/4]        // ...............................................................................................................................................................*........
        str.w r3, [r0, #distance/4]          // .................................................................................................................................................................*......
        str.w r4, [r0, #2*distance/4]        // ...................................................................................................................................................................*....
        str.w r5, [r0, #3*distance/4]        // .....................................................................................................................................................................*..
        str.w r2, [r0], #4                   // .......................................................................................................................................................................*
        vmov r14, s14                        // .......................................................................................................................................................................*

                                              // -------------------------------------------------------------------------- cycle (expected) --------------------------------------------------------------------------->
                                              // 0                        25                       50                       75                       100                      125                      150
                                              // |------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|-----------------
        // vmov s6, r0                        // *.......................................................................................................................................................................
        // ldr.w r2, [r0, #0]                 // *.......................................................................................................................................................................
        // ldr.w r3, [r0, #distance/4]        // .*......................................................................................................................................................................
        // ldr.w r4, [r0, #2*distance/4]      // ..*.....................................................................................................................................................................
        // ldr.w r5, [r0, #3*distance/4]      // ..*.....................................................................................................................................................................
        // ldr.w r6, [r0, #distance]          // ...*....................................................................................................................................................................
        // ldr.w r7, [r0, #5*distance/4]      // ...*....................................................................................................................................................................
        // ldr.w r8, [r0, #6*distance/4]      // ....*...................................................................................................................................................................
        // ldr.w r9, [r0, #7*distance/4]      // ....*...................................................................................................................................................................
        // movw r0, #24608                    // .....*..................................................................................................................................................................
        // ldr.w r10, [r1], #4                // .....*..................................................................................................................................................................
        // smulwb r14, r10, r3                // .......*................................................................................................................................................................
        // smulwt r3, r10, r3                 // ........*...............................................................................................................................................................
        // smlabt r14, r14, r12, r0           // .........*..............................................................................................................................................................
        // smlabt r3, r3, r12, r0             // ..........*.............................................................................................................................................................
        // pkhtb r14, r3, r14, asr #16        // ............*...........................................................................................................................................................
        // usub16 r3, r2, r14                 // .............*..........................................................................................................................................................
        // uadd16 r2, r2, r14                 // ..............*.........................................................................................................................................................
        // smulwb r14, r10, r5                // ..............*.........................................................................................................................................................
        // smulwt r5, r10, r5                 // ...............*........................................................................................................................................................
        // smlabt r14, r14, r12, r0           // ................*.......................................................................................................................................................
        // smlabt r5, r5, r12, r0             // .................*......................................................................................................................................................
        // pkhtb r14, r5, r14, asr #16        // ...................*....................................................................................................................................................
        // usub16 r5, r4, r14                 // ....................*...................................................................................................................................................
        // uadd16 r4, r4, r14                 // .....................*..................................................................................................................................................
        // smulwb r14, r10, r7                // .....................*..................................................................................................................................................
        // smulwt r7, r10, r7                 // ......................*.................................................................................................................................................
        // smlabt r14, r14, r12, r0           // .......................*................................................................................................................................................
        // smlabt r7, r7, r12, r0             // ........................*...............................................................................................................................................
        // pkhtb r14, r7, r14, asr #16        // ..........................*.............................................................................................................................................
        // usub16 r7, r6, r14                 // ...........................*............................................................................................................................................
        // uadd16 r6, r6, r14                 // ............................*...........................................................................................................................................
        // smulwb r14, r10, r9                // ............................*...........................................................................................................................................
        // smulwt r9, r10, r9                 // .............................*..........................................................................................................................................
        // smlabt r14, r14, r12, r0           // ..............................*.........................................................................................................................................
        // smlabt r9, r9, r12, r0             // ...............................*........................................................................................................................................
        // pkhtb r14, r9, r14, asr #16        // .................................*......................................................................................................................................
        // usub16 r9, r8, r14                 // ..................................*.....................................................................................................................................
        // uadd16 r8, r8, r14                 // ...................................*....................................................................................................................................
        // ldrd r10, r11, [r1], #8            // ...................................*....................................................................................................................................
        // smulwb r14, r10, r4                // ......................................*.................................................................................................................................
        // smulwt r4, r10, r4                 // .......................................*................................................................................................................................
        // smlabt r14, r14, r12, r0           // ........................................*...............................................................................................................................
        // smlabt r4, r4, r12, r0             // .........................................*..............................................................................................................................
        // pkhtb r14, r4, r14, asr #16        // ...........................................*............................................................................................................................
        // usub16 r4, r2, r14                 // ............................................*...........................................................................................................................
        // uadd16 r2, r2, r14                 // ............................................*...........................................................................................................................
        // smulwb r14, r11, r5                // .............................................*..........................................................................................................................
        // smulwt r5, r11, r5                 // ..............................................*.........................................................................................................................
        // smlabt r14, r14, r12, r0           // ...............................................*........................................................................................................................
        // smlabt r5, r5, r12, r0             // ................................................*.......................................................................................................................
        // pkhtb r14, r5, r14, asr #16        // ..................................................*.....................................................................................................................
        // usub16 r5, r3, r14                 // ...................................................*....................................................................................................................
        // uadd16 r3, r3, r14                 // ...................................................*....................................................................................................................
        // smulwb r14, r10, r8                // ....................................................*...................................................................................................................
        // smulwt r8, r10, r8                 // .....................................................*..................................................................................................................
        // smlabt r14, r14, r12, r0           // ......................................................*.................................................................................................................
        // smlabt r8, r8, r12, r0             // .......................................................*................................................................................................................
        // pkhtb r14, r8, r14, asr #16        // .........................................................*..............................................................................................................
        // usub16 r8, r6, r14                 // ..........................................................*.............................................................................................................
        // uadd16 r6, r6, r14                 // ..........................................................*.............................................................................................................
        // smulwb r14, r11, r9                // ...........................................................*............................................................................................................
        // smulwt r9, r11, r9                 // ............................................................*...........................................................................................................
        // smlabt r14, r14, r12, r0           // .............................................................*..........................................................................................................
        // smlabt r9, r9, r12, r0             // ..............................................................*.........................................................................................................
        // pkhtb r14, r9, r14, asr #16        // ................................................................*.......................................................................................................
        // usub16 r9, r7, r14                 // .................................................................*......................................................................................................
        // uadd16 r7, r7, r14                 // .................................................................*......................................................................................................
        // ldrd r10, r11, [r1], #8            // ..................................................................*.....................................................................................................
        // smulwb r14, r10, r6                // .....................................................................*..................................................................................................
        // smulwt r6, r10, r6                 // ......................................................................*.................................................................................................
        // smlabt r14, r14, r12, r0           // .......................................................................*................................................................................................
        // smlabt r6, r6, r12, r0             // ........................................................................*...............................................................................................
        // pkhtb r14, r6, r14, asr #16        // ..........................................................................*.............................................................................................
        // usub16 r6, r2, r14                 // ...........................................................................*............................................................................................
        // uadd16 r2, r2, r14                 // ...........................................................................*............................................................................................
        // smulwb r14, r11, r7                // ............................................................................*...........................................................................................
        // smulwt r7, r11, r7                 // .............................................................................*..........................................................................................
        // smlabt r14, r14, r12, r0           // ..............................................................................*.........................................................................................
        // smlabt r7, r7, r12, r0             // ...............................................................................*........................................................................................
        // pkhtb r14, r7, r14, asr #16        // .................................................................................*......................................................................................
        // usub16 r7, r3, r14                 // ..................................................................................*.....................................................................................
        // uadd16 r3, r3, r14                 // ...................................................................................*....................................................................................
        // ldrd r10, r11, [r1], #8            // ...................................................................................*....................................................................................
        // smulwb r14, r10, r8                // ......................................................................................*.................................................................................
        // smulwt r8, r10, r8                 // .......................................................................................*................................................................................
        // smlabt r14, r14, r12, r0           // ........................................................................................*...............................................................................
        // smlabt r8, r8, r12, r0             // .........................................................................................*..............................................................................
        // pkhtb r14, r8, r14, asr #16        // ...........................................................................................*............................................................................
        // usub16 r8, r4, r14                 // ............................................................................................*...........................................................................
        // uadd16 r4, r4, r14                 // ............................................................................................*...........................................................................
        // smulwb r14, r11, r9                // .............................................................................................*..........................................................................
        // smulwt r9, r11, r9                 // ..............................................................................................*.........................................................................
        // smlabt r14, r14, r12, r0           // ...............................................................................................*........................................................................
        // smlabt r9, r9, r12, r0             // ................................................................................................*.......................................................................
        // pkhtb r14, r9, r14, asr #16        // ..................................................................................................*.....................................................................
        // usub16 r9, r5, r14                 // ...................................................................................................*....................................................................
        // uadd16 r5, r5, r14                 // ....................................................................................................*...................................................................
        // ldrd r10, r11, [r1], #8            // ....................................................................................................*...................................................................
        // smulwb r14, r10, r2                // .......................................................................................................*................................................................
        // smulwt r2,   r10, r2               // ........................................................................................................*...............................................................
        // smlabt r14, r14, r12, r0           // .........................................................................................................*..............................................................
        // smlabt r2, r2, r12, r0             // ..........................................................................................................*.............................................................
        // pkhtb r2, r2, r14, asr #16         // ............................................................................................................*...........................................................
        // smulwb r14, r11, r3                // ............................................................................................................*...........................................................
        // smulwt r3,   r11, r3               // .............................................................................................................*..........................................................
        // smlabt r14, r14, r12, r0           // ..............................................................................................................*.........................................................
        // smlabt r3, r3, r12, r0             // ...............................................................................................................*........................................................
        // pkhtb r3, r3, r14, asr #16         // .................................................................................................................*......................................................
        // ldrd r10, r11, [r1], #8            // .................................................................................................................*......................................................
        // smulwb r14, r10, r4                // ....................................................................................................................*...................................................
        // smulwt r4,   r10, r4               // .....................................................................................................................*..................................................
        // smlabt r14, r14, r12, r0           // ......................................................................................................................*.................................................
        // smlabt r4, r4, r12, r0             // .......................................................................................................................*................................................
        // pkhtb r4, r4, r14, asr #16         // .........................................................................................................................*..............................................
        // smulwb r14, r11, r5                // .........................................................................................................................*..............................................
        // smulwt r5,   r11, r5               // ..........................................................................................................................*.............................................
        // smlabt r14, r14, r12, r0           // ...........................................................................................................................*............................................
        // smlabt r5, r5, r12, r0             // ............................................................................................................................*...........................................
        // pkhtb r5, r5, r14, asr #16         // ..............................................................................................................................*.........................................
        // ldrd r10, r11, [r1], #8            // ..............................................................................................................................*.........................................
        // smulwb r14, r10, r6                // .................................................................................................................................*......................................
        // smulwt r6,   r10, r6               // ..................................................................................................................................*.....................................
        // smlabt r14, r14, r12, r0           // ...................................................................................................................................*....................................
        // smlabt r6, r6, r12, r0             // ....................................................................................................................................*...................................
        // pkhtb r6, r6, r14, asr #16         // ......................................................................................................................................*.................................
        // smulwb r14, r11, r7                // ......................................................................................................................................*.................................
        // smulwt r7,   r11, r7               // .......................................................................................................................................*................................
        // smlabt r14, r14, r12, r0           // ........................................................................................................................................*...............................
        // smlabt r7, r7, r12, r0             // .........................................................................................................................................*..............................
        // pkhtb r7, r7, r14, asr #16         // ...........................................................................................................................................*............................
        // ldrd r10, r11, [r1], #8            // ...........................................................................................................................................*............................
        // smulwb r14, r10, r8                // ..............................................................................................................................................*.........................
        // smulwt r8,   r10, r8               // ...............................................................................................................................................*........................
        // smlabt r14, r14, r12, r0           // ................................................................................................................................................*.......................
        // smlabt r8, r8, r12, r0             // .................................................................................................................................................*......................
        // pkhtb r8, r8, r14, asr #16         // ...................................................................................................................................................*....................
        // smulwb r14, r11, r9                // ...................................................................................................................................................*....................
        // smulwt r9,   r11, r9               // ....................................................................................................................................................*...................
        // smlabt r14, r14, r12, r0           // .....................................................................................................................................................*..................
        // smlabt r9, r9, r12, r0             // ......................................................................................................................................................*.................
        // pkhtb r9, r9, r14, asr #16         // ........................................................................................................................................................*...............
        // vmov r0, s6                        // ........................................................................................................................................................*...............
        // str.w r6, [r0, #distance]          // .........................................................................................................................................................*..............
        // str.w r7, [r0, #5*distance/4]      // ...........................................................................................................................................................*............
        // str.w r8, [r0, #6*distance/4]      // .............................................................................................................................................................*..........
        // str.w r9, [r0, #7*distance/4]      // ...............................................................................................................................................................*........
        // str.w r3, [r0, #distance/4]        // .................................................................................................................................................................*......
        // str.w r4, [r0, #2*distance/4]      // ...................................................................................................................................................................*....
        // str.w r5, [r0, #3*distance/4]      // .....................................................................................................................................................................*..
        // str.w r2, [r0], #4                 // .......................................................................................................................................................................*
        // vmov r14, s14                      // .......................................................................................................................................................................*

        layer567_end:

 cmp.w poly, tmp
 bne.w 2b

 vpop.w {s16-s23}
 pop {r4-r11, pc}